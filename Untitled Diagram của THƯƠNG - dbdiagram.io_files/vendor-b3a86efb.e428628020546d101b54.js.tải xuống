!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="45a05487-d21b-44b5-808e-8a15889855b4",e._sentryDebugIdIdentifier="sentry-dbid-45a05487-d21b-44b5-808e-8a15889855b4")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"13ad4a0c312011ebb49f3e8dc8f97be809f60d04"},(self.webpackChunkschema_diagram_vue=self.webpackChunkschema_diagram_vue||[]).push([[9835],{22935:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=t(2543),o=t(81744),r=t(8974);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(o=a.key,r=void 0,r=function(e,n){if("object"!==c(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!==c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(o,"string"),"symbol"===c(r)?r:String(r)),a)}var o,r}var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,c;return n=e,c=[{key:"hasWhiteSpace",value:function(e){return/\s/g.test(e)}},{key:"hasSquareBracket",value:function(e){return/\[|\]/.test(e)}},{key:"isExpression",value:function(e){return/\s*(\*|\+|-|\([A-Za-z0-9_]+\)|\(\))/g.test(e)}},{key:"escapeNote",value:function(e){if(null===e)return"";var n=e.replaceAll("\\","\\\\");return n.match(/[\n\r']/)?(n=(n=n.replaceAll("'","\\'")).replaceAll("\r\n","\n"),"'''".concat(n,"'''")):"'".concat(n,"'")}},{key:"exportEnums",value:function(n,t){var a=n.map((function(n){var a=t.enums[n],r=t.schemas[a.schemaId];return"Enum ".concat((0,o.shouldPrintSchema)(r,t)?'"'.concat(r.name,'".'):"",'"').concat(a.name,'" {\n').concat(a.valueIds.map((function(n){return'  "'.concat(t.enumValues[n].name,'"').concat(t.enumValues[n].note?" [note: ".concat(e.escapeNote(t.enumValues[n].note),"]"):"")})).join("\n"),"\n}\n")}));return a.length?a.join("\n"):""}},{key:"getFieldLines",value:function(n,t){return t.tables[n].fieldIds.map((function(n){var a=t.fields[n],o="";a.type.schemaName&&a.type.schemaName!==r.DEFAULT_SCHEMA_NAME&&(o=e.hasWhiteSpace(a.type.schemaName)?'"'.concat(a.type.schemaName,'".'):"".concat(a.type.schemaName,"."));var c='"'.concat(a.name,'" ').concat(o).concat(e.hasWhiteSpace(a.type.type_name)||e.hasSquareBracket(a.type.type_name)?'"'.concat(a.type.type_name,'"'):a.type.type_name),u=[];if(a.unique&&u.push("unique"),a.pk&&u.push("pk"),a.not_null&&u.push("not null"),a.increment&&u.push("increment"),a.dbdefault){var i="default: ";switch(a.dbdefault.type){case"boolean":case"number":i+="".concat(a.dbdefault.value);break;case"string":var l=a.dbdefault.value.includes("\n")?"'''":"'";i+="".concat(l).concat(a.dbdefault.value).concat(l);break;case"expression":i+="`".concat(a.dbdefault.value,"`")}u.push(i)}return a.note&&u.push("note: ".concat(e.escapeNote(a.note))),u.length>0&&(c+=" [".concat(u.join(", "),"]")),c}))}},{key:"getIndexLines",value:function(e,n){return n.tables[e].indexIds.map((function(e){var t="",a=n.indexes[e];if(a.columnIds.length>1)t="(".concat(a.columnIds.map((function(e){var t=n.indexColumns[e];return"expression"===t.type?"`".concat(t.value,"`"):t.value})).join(", "),")");else if(1===a.columnIds.length){var o=n.indexColumns[a.columnIds[0]];t="expression"===o.type?"`".concat(o.value,"`"):o.value}var r=[];return a.pk&&r.push("pk"),a.type&&r.push("type: ".concat(a.type.toLowerCase())),a.unique&&r.push("unique"),a.name&&r.push('name: "'.concat(a.name,'"')),r.length>1?t+=" [".concat(r.join(", "),"]"):1===r.length&&(t+=" [".concat(r[0],"]")),t}))}},{key:"getTableContentArr",value:function(n,t){return n.map((function(n){return{tableId:n,fieldContents:e.getFieldLines(n,t),indexContents:e.getIndexLines(n,t)}}))}},{key:"getTableSettings",value:function(e){var n="";return e.headerColor&&(n+="headerColor: ".concat(e.headerColor).concat(", ")),n.endsWith(", ")&&(n=n.replace(/,\s$/,"")),n?" [".concat(n,"]"):""}},{key:"exportTables",value:function(n,t){var r=e.getTableContentArr(n,t).map((function(n){var r=t.tables[n.tableId],c=t.schemas[r.schemaId],u=e.getTableSettings(r),i='"'.concat(r.name,'"');(0,o.shouldPrintSchema)(c,t)&&(i='"'.concat(c.name,'"."').concat(r.name,'"'));var l=n.fieldContents.map((function(e){return"  ".concat(e,"\n")})).join(""),s="";if(!(0,a.isEmpty)(n.indexContents)){var d=n.indexContents.map((function(e){return"    ".concat(e,"\n")})).join("");s="\n  Indexes {\n".concat(d,"  }\n")}var f=r.note?"  Note: ".concat(e.escapeNote(r.note),"\n"):"";return"Table ".concat(i).concat(u," {\n").concat(l).concat(s).concat(f,"}\n")}));return r.length?r.join("\n"):""}},{key:"buildFieldName",value:function(e,n){var t=e.map((function(e){return'"'.concat(n.fields[e].name,'"')})).join(", ");return 1===e.length?t:"(".concat(t,")")}},{key:"exportRefs",value:function(e,n){var t=this,a=e.map((function(e){var a=n.refs[e],r=a.endpointIds.findIndex((function(e){return"1"===n.endpoints[e].relation})),c=-1===r,u=c?0:r,i=a.endpointIds[1-u],l=a.endpointIds[u],s=n.endpoints[i],d=n.endpoints[l],f="Ref",m=n.fields[d.fieldIds[0]],p=n.tables[m.tableId],b=n.schemas[p.schemaId],y=t.buildFieldName(d.fieldIds,n,"dbml");a.name&&(f+=" ".concat((0,o.shouldPrintSchema)(n.schemas[a.schemaId],n)?'"'.concat(n.schemas[a.schemaId].name,'".'):"",'"').concat(a.name,'"')),f+=":",f+="".concat((0,o.shouldPrintSchema)(b,n)?'"'.concat(b.name,'".'):"",'"').concat(p.name,'".').concat(y," ");var v=n.fields[s.fieldIds[0]],h=n.tables[v.tableId],E=n.schemas[h.schemaId],I=t.buildFieldName(s.fieldIds,n,"dbml");c?f+="<> ":"1"===s.relation?f+="- ":f+="< ",f+="".concat((0,o.shouldPrintSchema)(E,n)?'"'.concat(E.name,'".'):"",'"').concat(h.name,'".').concat(I);var T=[];return a.onUpdate&&T.push("update: ".concat(a.onUpdate.toLowerCase())),a.onDelete&&T.push("delete: ".concat(a.onDelete.toLowerCase())),T.length>0&&(f+=" [".concat(T.join(", "),"]")),f+="\n"}));return a.length?a.join("\n"):""}},{key:"getTableGroupSettings",value:function(e){var n=[];return e.color&&n.push("color: ".concat(e.color)),n.length?" [".concat(n.join(", "),"]"):""}},{key:"exportTableGroups",value:function(n,t){var a=n.map((function(n){var a=t.tableGroups[n],r=t.schemas[a.schemaId],c=e.getTableGroupSettings(a),u=a.note?"  Note: ".concat(e.escapeNote(a.note),"\n"):"",i=(0,o.shouldPrintSchema)(r,t)?'"'.concat(r.name,'".'):"",l="".concat(i,'"').concat(a.name,'"'),s=a.tableIds.reduce((function(e,n){var a=t.tables[n],r=t.schemas[a.schemaId],c="  ".concat((0,o.shouldPrintSchema)(r,t)?'"'.concat(r.name,'".'):"",'"').concat(a.name,'"');return e+"".concat(c,"\n")}),"");return"TableGroup ".concat(l).concat(c," {\n").concat(s).concat(u,"}\n")}));return a.length?a.join("\n"):""}},{key:"exportStickyNotes",value:function(n){return(0,a.reduce)(n.notes,(function(n,t){var a="  ".concat(e.escapeNote(t.content)),o="Note ".concat(t.name," {\n").concat(a,"\n}\n");return n?n+"\n"+o:o}),"")}},{key:"export",value:function(n){var t=[];return n.database[1].schemaIds.forEach((function(o){var r=n.schemas[o],c=r.enumIds,u=r.tableIds,i=r.tableGroupIds,l=r.refIds;(0,a.isEmpty)(c)||t.push(e.exportEnums(c,n)),(0,a.isEmpty)(u)||t.push(e.exportTables(u,n)),(0,a.isEmpty)(i)||t.push(e.exportTableGroups(i,n)),(0,a.isEmpty)(l)||t.push(e.exportRefs(l,n))})),(0,a.isEmpty)(n.notes)||t.push(e.exportStickyNotes(n)),t.join("\n")}}],(t=null)&&u(n.prototype,t),c&&u(n,c),Object.defineProperty(n,"prototype",{writable:!1}),e}();n.default=i},41730:function(e,n){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function a(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,c=void 0,c=function(e,n){if("object"!==t(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,n||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(r,"string"),"symbol"===t(c)?c:String(c)),o)}var r,c}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"export",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?JSON.stringify(e.export(),null,2):JSON.stringify(e,null,2)}}],(t=null)&&a(n.prototype,t),o&&a(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}(),r=o;n.default=r},82109:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=l(t(22935)),o=l(t(27878)),r=l(t(76443)),c=l(t(41730)),u=l(t(57135)),i=l(t(4078));function l(e){return e&&e.__esModule?e:{default:e}}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function d(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(o=a.key,r=void 0,r=function(e,n){if("object"!==s(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!==s(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(o,"string"),"symbol"===s(r)?r:String(r)),a)}var o,r}var f=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,l;return n=e,l=[{key:"export",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l="",s=t?e:e.normalize();switch(n){case"dbml":l=a.default.export(s);break;case"mysql":l=o.default.export(s);break;case"postgres":l=r.default.export(s);break;case"json":l=c.default.export(e,t);break;case"mssql":l=u.default.export(s);break;case"oracle":l=i.default.export(s)}return l}}],(t=null)&&d(n.prototype,t),l&&d(n,l),Object.defineProperty(n,"prototype",{writable:!1}),e}(),m=f;n.default=m},27878:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,o=(a=t(2543))&&a.__esModule?a:{default:a},r=t(81744);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return i(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function l(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(o=a.key,r=void 0,r=function(e,n){if("object"!==c(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!==c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(o,"string"),"symbol"===c(r)?r:String(r)),a)}var o,r}var s=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,a;return n=e,a=[{key:"getFieldLines",value:function(e,n){return n.tables[e].fieldIds.map((function(e){var t=n.fields[e],a="";if(t.enumId){var o=n.enums[t.enumId];a="`".concat(t.name,"` ENUM (");var r=o.valueIds.map((function(e){return"'".concat(n.enumValues[e].name,"'")}));a+="".concat(r.join(", "),")")}else a="`".concat(t.name,"` ").concat("varchar"!==t.type.type_name?t.type.type_name:"varchar(255)");return t.unique&&(a+=" UNIQUE"),t.pk&&(a+=" PRIMARY KEY"),t.not_null&&(a+=" NOT NULL"),t.increment&&(a+=" AUTO_INCREMENT"),t.dbdefault&&("expression"===t.dbdefault.type?a+=" DEFAULT (".concat(t.dbdefault.value,")"):"string"===t.dbdefault.type?a+=" DEFAULT '".concat(t.dbdefault.value,"'"):a+=" DEFAULT ".concat(t.dbdefault.value)),t.note&&(a+=" COMMENT '".concat(t.note.replace(/'/g,"''"),"'")),a}))}},{key:"getCompositePKs",value:function(e,n){var t=n.tables[e];return(t.indexIds?t.indexIds.filter((function(e){return n.indexes[e].pk})):[]).map((function(e){var t=n.indexes[e],a="PRIMARY KEY",o=[];return t.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):"`".concat(t.value,"`"),o.push(a)})),a+=" (".concat(o.join(", "),")")}))}},{key:"getTableContentArr",value:function(n,t){return n.map((function(n){return{tableId:n,fieldContents:e.getFieldLines(n,t),compositePKs:e.getCompositePKs(n,t)}}))}},{key:"exportTables",value:function(n,t){return e.getTableContentArr(n,t).map((function(e){var n=[].concat(u(e.fieldContents),u(e.compositePKs)),a=t.tables[e.tableId],o=t.schemas[a.schemaId];return"CREATE TABLE ".concat((0,r.shouldPrintSchema)(o,t)?"`".concat(o.name,"`."):"","`").concat(a.name,"` (\n").concat(n.map((function(e){return"  ".concat(e)})).join(",\n"),"\n);\n")}))}},{key:"buildFieldName",value:function(e,n){var t=e.map((function(e){return"`".concat(n.fields[e].name,"`")})).join(", ");return"(".concat(t,")")}},{key:"buildTableManyToMany",value:function(e,n,t,a,o){var c="CREATE TABLE ".concat((0,r.shouldPrintSchema)(a,o)?"`".concat(a.name,"`."):"","`").concat(t,"` (\n"),i=u(e.keys()).join("`, `"),l=u(n.keys()).join("`, `");return e.forEach((function(e,n){c+="  `".concat(n,"` ").concat(e,",\n")})),n.forEach((function(e,n){c+="  `".concat(n,"` ").concat(e,",\n")})),c+="  PRIMARY KEY (`".concat(i,"`, `").concat(l,"`)\n"),c+=");\n\n"}},{key:"buildForeignKeyManyToMany",value:function(e,n,t,a,o,c,i){var l=u(e.keys()).join("`, `");return"ALTER TABLE ".concat((0,r.shouldPrintSchema)(o,i)?"`".concat(o.name,"`."):"","`").concat(t,"` ADD FOREIGN KEY (`").concat(l,"`) REFERENCES ").concat((0,r.shouldPrintSchema)(c,i)?"`".concat(c.name,"`."):"","`").concat(a,"` ").concat(n,";\n\n")}},{key:"exportRefs",value:function(e,n,t){var a=this;return e.map((function(e){var o="",c=n.refs[e],u=c.endpointIds.findIndex((function(e){return"1"===n.endpoints[e].relation})),i=-1===u?0:u,l=c.endpointIds[1-i],s=c.endpointIds[i],d=n.endpoints[l],f=n.endpoints[s],m=n.fields[f.fieldIds[0]],p=n.tables[m.tableId],b=n.schemas[p.schemaId],y=a.buildFieldName(f.fieldIds,n,"mysql"),v=n.fields[d.fieldIds[0]],h=n.tables[v.tableId],E=n.schemas[h.schemaId],I=a.buildFieldName(d.fieldIds,n,"mysql");if(-1===u){var T=(0,r.buildJunctionFields1)(f.fieldIds,n),S=(0,r.buildJunctionFields2)(d.fieldIds,n,T),N=(0,r.buildNewTableName)(p.name,h.name,t);o+=a.buildTableManyToMany(T,S,N,b,n),o+=a.buildForeignKeyManyToMany(T,y,N,p.name,b,b,n),o+=a.buildForeignKeyManyToMany(S,I,N,h.name,b,E,n)}else o="ALTER TABLE ".concat((0,r.shouldPrintSchema)(E,n)?"`".concat(E.name,"`."):"","`").concat(h.name,"` ADD "),c.name&&(o+="CONSTRAINT `".concat(c.name,"` ")),o+="FOREIGN KEY ".concat(I," REFERENCES ").concat((0,r.shouldPrintSchema)(b,n)?"`".concat(b.name,"`."):"","`").concat(p.name,"` ").concat(y),c.onDelete&&(o+=" ON DELETE ".concat(c.onDelete.toUpperCase())),c.onUpdate&&(o+=" ON UPDATE ".concat(c.onUpdate.toUpperCase())),o+=";\n";return o}))}},{key:"exportIndexes",value:function(e,n){return e.filter((function(e){return!n.indexes[e].pk})).map((function(e,t){var a=n.indexes[e],o=n.tables[a.tableId],c=n.schemas[o.schemaId],u="CREATE";a.unique&&(u+=" UNIQUE");var i=a.name?"`".concat(a.name,"`"):"`".concat((0,r.shouldPrintSchema)(c,n)?"`".concat(c.name,"`."):"").concat(o.name,"_index_").concat(t,"`");u+=" INDEX ".concat(i," ON ").concat((0,r.shouldPrintSchema)(c,n)?"`".concat(c.name,"`."):"","`").concat(o.name,"`");var l=[];return a.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):"`".concat(t.value,"`"),l.push(a)})),u+=" (".concat(l.join(", "),")"),a.type&&(u+=" USING ".concat(a.type.toUpperCase())),u+=";\n"}))}},{key:"exportComments",value:function(e,n){return e.map((function(e){var t="";if("table"===e.type){var a=n.tables[e.tableId],o=n.schemas[a.schemaId];t+="ALTER TABLE ".concat((0,r.shouldPrintSchema)(o,n)?"`".concat(o.name,"`."):"","`").concat(a.name,"` COMMENT = '").concat(a.note.replace(/'/g,"''"),"'")}return t+=";\n"}))}},{key:"export",value:function(n){var t=n.database[1],a=new Set(Object.values(n.tables).map((function(e){return e.name}))),c=t.schemaIds.reduce((function(t,c){var i,l=n.schemas[c],s=l.tableIds,d=l.refIds;(0,r.shouldPrintSchema)(l,n)&&t.schemas.push("CREATE SCHEMA `".concat(l.name,"`;\n")),o.default.isEmpty(s)||(i=t.tables).push.apply(i,u(e.exportTables(s,n)));var f,m=o.default.flatten(s.map((function(e){return n.tables[e].indexIds})));o.default.isEmpty(m)||(f=t.indexes).push.apply(f,u(e.exportIndexes(m,n)));var p,b,y=o.default.flatten(s.map((function(e){return n.tables[e].note?[{type:"table",tableId:e}]:[]})));return o.default.isEmpty(y)||(p=t.comments).push.apply(p,u(e.exportComments(y,n))),o.default.isEmpty(d)||(b=t.refs).push.apply(b,u(e.exportRefs(d,n,a))),t}),{schemas:[],enums:[],tables:[],indexes:[],comments:[],refs:[]});return o.default.concat(c.schemas,c.enums,c.tables,c.indexes,c.comments,c.refs).join("\n")}}],(t=null)&&l(n.prototype,t),a&&l(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}();n.default=s},4078:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,o=(a=t(2543))&&a.__esModule?a:{default:a},r=t(81744);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return i(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e,n,t){return(n=f(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function d(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,f(a.key),a)}}function f(e){var n=function(e,n){if("object"!==c(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!==c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===c(n)?n:String(n)}var m=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,a;return n=e,a=[{key:"buildSchemaToTableNameSetMap",value:function(e){var n=new Map;return o.default.forEach(e.tables,(function(t){var a=e.schemas[t.schemaId],o=n.get(a.name);o?o.add(t.name):n.set(a.name,new Set([t.name]))})),n}},{key:"buildTableNameWithSchema",value:function(e,n,t){return"".concat((0,r.shouldPrintSchema)(n,e)?"".concat((0,r.escapeObjectName)(n.name,"oracle"),"."):"").concat((0,r.escapeObjectName)(t.name,"oracle"))}},{key:"exportSchema",value:function(e){return"CREATE USER ".concat((0,r.escapeObjectName)(e,"oracle"),"\n")+"NO AUTHENTICATION\nDEFAULT TABLESPACE system\nTEMPORARY TABLESPACE temp\nQUOTA UNLIMITED ON system;\n"}},{key:"getFieldLines",value:function(e,n){var t=n.tables[e].fieldIds.map((function(e){var t=n.fields[e],a=(0,r.escapeObjectName)(t.name,"oracle"),o=a;if(t.enumId){var c=n.enums[t.enumId].valueIds.map((function(e){var t=n.enumValues[e];return"'".concat(t.name,"'")})).join(", ");o+=" nvarchar2(255) NOT NULL CHECK (".concat(a," IN (").concat(c,"))")}else o+=" ".concat(t.type.type_name);var u=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},t);return u.increment&&(o+=" GENERATED AS IDENTITY",u.dbdefault=null,u.not_null=!1),u.unique&&(o+=" UNIQUE"),u.pk&&(o+=" PRIMARY KEY"),u.not_null&&(o+=" NOT NULL"),u.dbdefault&&("string"===u.dbdefault.type?o+=" DEFAULT '".concat(u.dbdefault.value,"'"):o+=" DEFAULT ".concat(u.dbdefault.value)),o}));return t}},{key:"getCompositePKs",value:function(e,n){var t=n.tables[e];return(t.indexIds?t.indexIds.filter((function(e){return n.indexes[e].pk})):[]).map((function(e){var t=n.indexes[e],a="PRIMARY KEY",o=[];return t.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):'"'.concat(t.value,'"'),o.push(a)})),a+=" (".concat(o.join(", "),")")}))}},{key:"getTableContents",value:function(e,n){var t=this;return e.map((function(e){return{tableId:e,fieldContents:t.getFieldLines(e,n),compositePKs:t.getCompositePKs(e,n)}}))}},{key:"exportTables",value:function(e,n){var t=this;return this.getTableContents(e,n).map((function(e){var a=[].concat(u(e.fieldContents),u(e.compositePKs)),o=n.tables[e.tableId],r=n.schemas[o.schemaId],c=t.buildTableNameWithSchema(n,r,o),i=a.map((function(e){return"  ".concat(e)})).join(",\n");return"CREATE TABLE ".concat(c," (\n").concat(i,"\n);\n")}))}},{key:"buildReferenceFieldNamesString",value:function(e,n){var t=e.map((function(e){return'"'.concat(n.fields[e].name,'"')})).join(", ");return"(".concat(t,")")}},{key:"buildTableManyToMany",value:function(e,n,t){var a="CREATE TABLE ".concat(t," (\n");e.forEach((function(e,n){a+='  "'.concat(n,'" ').concat(e,",\n")})),n.forEach((function(e,n){a+='  "'.concat(n,'" ').concat(e,",\n")}));var o=u(e.keys()).join("`, `"),r=u(n.keys()).join("`, `");return a+='  PRIMARY KEY ("'.concat(o,'", "').concat(r,'")\n);\n')}},{key:"buildForeignKeyManyToMany",value:function(e,n,t,a){var o=u(n.keys()).join("`, `");return"ALTER TABLE ".concat(e,' ADD FOREIGN KEY ("').concat(o,'") REFERENCES ').concat(t," ").concat(a,";\n")}},{key:"exportReferencesAndNewTablesIfExists",value:function(e,n,t){var a=this,o={refs:[],tables:[]};return e.forEach((function(e){var c=n.refs[e],u=c.endpointIds.findIndex((function(e){return"1"===n.endpoints[e].relation})),i=-1===u?0:u,l=c.endpointIds[1-i],s=n.endpoints[l],d=n.fields[s.fieldIds[0]],f=n.tables[d.tableId],m=n.schemas[f.schemaId],p=a.buildReferenceFieldNamesString(s.fieldIds,n),b=c.endpointIds[i],y=n.endpoints[b],v=n.fields[y.fieldIds[0]],h=n.tables[v.tableId],E=n.schemas[h.schemaId],I=a.buildReferenceFieldNamesString(y.fieldIds,n);if(-1!==u){var T=a.buildTableNameWithSchema(n,m,f),S="ALTER TABLE ".concat(T," ADD");c.name&&(S+=" CONSTRAINT ".concat((0,r.escapeObjectName)(c.name,"oracle")));var N=a.buildTableNameWithSchema(n,E,h);return S+=" FOREIGN KEY ".concat(p," REFERENCES ").concat(N," ").concat(I),c.onDelete&&(S+=" ON DELETE ".concat(c.onDelete.toUpperCase())),S+=";\n",void o.refs.push(S)}var g=(0,r.buildJunctionFields1)(y.fieldIds,n),A=(0,r.buildJunctionFields2)(s.fieldIds,n,g),x=(0,r.buildUniqueTableName)(E,h.name,f.name,t),C=t.get(E);C?C.add(x):t.set(E,new Set([x]));var P="".concat((0,r.shouldPrintSchema)(E,n)?'"'.concat(E.name,'".'):"",'"').concat(x,'"');o.tables.push(a.buildTableManyToMany(g,A,P));var j=a.buildTableNameWithSchema(n,E,h);o.refs.push(a.buildForeignKeyManyToMany(P,g,j,I));var k=a.buildTableNameWithSchema(n,m,f);o.refs.push(a.buildForeignKeyManyToMany(P,A,k,p))})),o}},{key:"exportReferenceGrants",value:function(e,n){var t=this;if(Object.keys(e.schemas).length<=1)return[];var a=[];return n.forEach((function(n){var o=e.refs[n],r=o.endpointIds.findIndex((function(n){return"1"===e.endpoints[n].relation})),c=-1===r?0:r,u=o.endpointIds[c],i=e.endpoints[u],l=e.fields[i.fieldIds[0]],s=e.tables[l.tableId],d=e.schemas[s.schemaId],f=o.endpointIds[1-c],m=e.endpoints[f],p=e.fields[m.fieldIds[0]],b=e.tables[p.tableId],y=e.schemas[b.schemaId];if(d.name!==y.name){var v=t.buildTableNameWithSchema(e,d,s);if(a.push(v),-1===r){var h=t.buildTableNameWithSchema(e,y,b);a.push(h)}}else a.push("")})),a.filter((function(e,n){return e&&a.indexOf(e)===n})).map((function(e){return"GRANT REFERENCES ON ".concat(e," TO PUBLIC;\n")}))}},{key:"exportIndexes",value:function(e,n){var t=this;return e.filter((function(e){return!n.indexes[e].pk})).map((function(e){var a=n.indexes[e],o=n.tables[a.tableId],c=n.schemas[o.schemaId],u="CREATE";a.unique&&(u+=" UNIQUE"),u+=" INDEX",a.name&&(u+=" ".concat((0,r.escapeObjectName)(a.name,"oracle")));var i=t.buildTableNameWithSchema(n,c,o);u+=" ON ".concat(i);var l=[];a.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"".concat(t.value):'"'.concat(t.value,'"'),l.push(a)}));var s=l.join(", ");return u+=" (".concat(s,");\n")}))}},{key:"exportComments",value:function(e,n){var t=this;return e.map((function(e){var a="COMMENT ON",o=n.tables[e.tableId],c=n.schemas[o.schemaId],u=t.buildTableNameWithSchema(n,c,o);switch(e.type){case"table":a+=" TABLE ".concat(u," IS '").concat(o.note.replace(/'/g,"''"),"'");break;case"column":var i=n.fields[e.fieldId];a+=" COLUMN ".concat(u,".").concat((0,r.escapeObjectName)(i.name,"oracle")," IS '").concat(i.note.replace(/'/g,"''"),"'")}return a+=";\n"}))}},{key:"export",value:function(e){var n=this,t=e.database[1],a=this.buildSchemaToTableNameSetMap(e),c=t.schemaIds.reduce((function(t,c){var i,l=e.schemas[c],s=l.tableIds,d=l.refIds;(0,r.shouldPrintSchema)(l,e)&&t.schemas.push(n.exportSchema(l.name)),o.default.isEmpty(s)||(i=t.tables).push.apply(i,u(n.exportTables(s,e)));var f,m=o.default.flatten(s.map((function(n){return e.tables[n].indexIds})));o.default.isEmpty(m)||(f=t.indexes).push.apply(f,u(n.exportIndexes(m,e)));var p,b=o.default.flatten(s.map((function(n){var t=e.tables[n],a=t.fieldIds,o=t.note,r=a.filter((function(n){return e.fields[n].note})).map((function(e){return{type:"column",fieldId:e,tableId:n}}));return o?[{type:"table",tableId:n}].concat(r):r})));if(o.default.isEmpty(b)||(p=t.comments).push.apply(p,u(n.exportComments(b,e))),!o.default.isEmpty(d)){var y,v,h,E=n.exportReferencesAndNewTablesIfExists(d,e,a),I=E.refs,T=E.tables;(y=t.tables).push.apply(y,u(T)),(v=t.refs).push.apply(v,u(I)),(h=t.referenceGrants).push.apply(h,u(n.exportReferenceGrants(e,d)))}return t}),{schemas:[],tables:[],indexes:[],comments:[],referenceGrants:[],refs:[]});return o.default.concat(c.schemas,c.tables,c.indexes,c.comments,c.referenceGrants,c.refs).join("\n")}}],(t=null)&&d(n.prototype,t),a&&d(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}(),p=m;n.default=p},76443:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,o=(a=t(2543))&&a.__esModule?a:{default:a},r=t(81744),c=t(8974);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function s(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(o=a.key,r=void 0,r=function(e,n){if("object"!==u(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!==u(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(o,"string"),"symbol"===u(r)?r:String(r)),a)}var o,r}var d=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,a;return n=e,a=[{key:"exportEnums",value:function(e,n){return e.map((function(e){var t=n.enums[e],a=n.schemas[t.schemaId],o=t.valueIds.map((function(e){var t=n.enumValues[e];return"  '".concat(t.name,"'")})).join(",\n");return"CREATE TYPE ".concat((0,r.shouldPrintSchema)(a,n)?'"'.concat(a.name,'".'):"",'"').concat(t.name,'" AS ENUM (\n').concat(o,"\n);\n")}))}},{key:"getFieldLines",value:function(e,n){return n.tables[e].fieldIds.map((function(e){var t=n.fields[e],a="";if(t.increment){var o=new Set(["BIGINT","INT","INTEGER","SMALLINT"]),u=new Set(["SMALLSERIAL","SERIAL","BIGSERIAL"]),i=t.type.type_name.toUpperCase(),l="";l=o.has(i)?"".concat(i," GENERATED BY DEFAULT AS IDENTITY"):u.has(i)?i:"SERIAL",a='"'.concat(t.name,'" ').concat(l)}else{var s="";t.type.schemaName&&t.type.schemaName!==c.DEFAULT_SCHEMA_NAME&&(s=(0,r.hasWhiteSpace)(t.type.schemaName)?'"'.concat(t.type.schemaName,'".'):"".concat(t.type.schemaName,"."));var d=(0,r.hasWhiteSpace)(t.type.type_name)?'"'.concat(t.type.type_name,'"'):t.type.type_name;a='"'.concat(t.name,'" ').concat(s).concat(d)}return t.unique&&(a+=" UNIQUE"),t.pk&&(a+=" PRIMARY KEY"),t.not_null&&(a+=" NOT NULL"),t.dbdefault&&("expression"===t.dbdefault.type?a+=" DEFAULT (".concat(t.dbdefault.value,")"):"string"===t.dbdefault.type?a+=" DEFAULT '".concat(t.dbdefault.value,"'"):a+=" DEFAULT ".concat(t.dbdefault.value)),a}))}},{key:"getCompositePKs",value:function(e,n){var t=n.tables[e];return(t.indexIds?t.indexIds.filter((function(e){return n.indexes[e].pk})):[]).map((function(e){var t=n.indexes[e],a="PRIMARY KEY",o=[];return t.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):'"'.concat(t.value,'"'),o.push(a)})),a+=" (".concat(o.join(", "),")")}))}},{key:"getTableContentArr",value:function(n,t){return n.map((function(n){return{tableId:n,fieldContents:e.getFieldLines(n,t),compositePKs:e.getCompositePKs(n,t)}}))}},{key:"exportTables",value:function(n,t){return e.getTableContentArr(n,t).map((function(e){var n=[].concat(i(e.fieldContents),i(e.compositePKs)),a=t.tables[e.tableId],o=t.schemas[a.schemaId];return"CREATE TABLE ".concat((0,r.shouldPrintSchema)(o,t)?'"'.concat(o.name,'".'):"",'"').concat(a.name,'" (\n').concat(n.map((function(e){return"  ".concat(e)})).join(",\n"),"\n);\n")}))}},{key:"buildFieldName",value:function(e,n){var t=e.map((function(e){return'"'.concat(n.fields[e].name,'"')})).join(", ");return"(".concat(t,")")}},{key:"buildTableManyToMany",value:function(e,n,t,a,o){var c="CREATE TABLE ".concat((0,r.shouldPrintSchema)(a,o)?'"'.concat(a.name,'".'):"",'"').concat(t,'" (\n'),u=i(e.keys()).join('", "'),l=i(n.keys()).join('", "');return e.forEach((function(e,n){c+='  "'.concat(n,'" ').concat(e,",\n")})),n.forEach((function(e,n){c+='  "'.concat(n,'" ').concat(e,",\n")})),c+='  PRIMARY KEY ("'.concat(u,'", "').concat(l,'")\n'),c+=");\n\n"}},{key:"buildForeignKeyManyToMany",value:function(e,n,t,a,o,c,u){var l=i(e.keys()).join('", "');return"ALTER TABLE ".concat((0,r.shouldPrintSchema)(o,u)?'"'.concat(o.name,'".'):"",'"').concat(t,'" ADD FOREIGN KEY ("').concat(l,'") REFERENCES ').concat((0,r.shouldPrintSchema)(c,u)?'"'.concat(c.name,'".'):"",'"').concat(a,'" ').concat(n,";\n\n")}},{key:"exportRefs",value:function(e,n,t){var a=this;return e.map((function(e){var o="",c=n.refs[e],u=c.endpointIds.findIndex((function(e){return"1"===n.endpoints[e].relation})),i=-1===u?0:u,l=c.endpointIds[1-i],s=c.endpointIds[i],d=n.endpoints[l],f=n.endpoints[s],m=n.fields[f.fieldIds[0]],p=n.tables[m.tableId],b=n.schemas[p.schemaId],y=a.buildFieldName(f.fieldIds,n,"postgres"),v=n.fields[d.fieldIds[0]],h=n.tables[v.tableId],E=n.schemas[h.schemaId],I=a.buildFieldName(d.fieldIds,n,"postgres");if(-1===u){var T=(0,r.buildJunctionFields1)(f.fieldIds,n),S=(0,r.buildJunctionFields2)(d.fieldIds,n,T),N=(0,r.buildNewTableName)(p.name,h.name,t);o+=a.buildTableManyToMany(T,S,N,b,n),o+=a.buildForeignKeyManyToMany(T,y,N,p.name,b,b,n),o+=a.buildForeignKeyManyToMany(S,I,N,h.name,b,E,n)}else o="ALTER TABLE ".concat((0,r.shouldPrintSchema)(E,n)?'"'.concat(E.name,'".'):"",'"').concat(h.name,'" ADD '),c.name&&(o+='CONSTRAINT "'.concat(c.name,'" ')),o+="FOREIGN KEY ".concat(I," REFERENCES ").concat((0,r.shouldPrintSchema)(b,n)?'"'.concat(b.name,'".'):"",'"').concat(p.name,'" ').concat(y),c.onDelete&&(o+=" ON DELETE ".concat(c.onDelete.toUpperCase())),c.onUpdate&&(o+=" ON UPDATE ".concat(c.onUpdate.toUpperCase())),o+=";\n";return o}))}},{key:"exportIndexes",value:function(e,n){return e.filter((function(e){return!n.indexes[e].pk})).map((function(e){var t=n.indexes[e],a=n.tables[t.tableId],o=n.schemas[a.schemaId],c="CREATE";t.unique&&(c+=" UNIQUE");var u=t.name?'"'.concat(t.name,'"'):"";c+=" INDEX",u&&(c+=" ".concat(u)),c+=" ON ".concat((0,r.shouldPrintSchema)(o,n)?'"'.concat(o.name,'".'):"",'"').concat(a.name,'"'),t.type&&(c+=" USING ".concat(t.type.toUpperCase()));var i=[];return t.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):'"'.concat(t.value,'"'),i.push(a)})),c+=" (".concat(i.join(", "),")"),c+=";\n"}))}},{key:"exportComments",value:function(e,n){return e.map((function(e){var t="COMMENT ON",a=n.tables[e.tableId],o=n.schemas[a.schemaId];switch(e.type){case"table":t+=" TABLE ".concat((0,r.shouldPrintSchema)(o,n)?'"'.concat(o.name,'".'):"",'"').concat(a.name,"\" IS '").concat(a.note.replace(/'/g,"''"),"'");break;case"column":var c=n.fields[e.fieldId];t+=" COLUMN ".concat((0,r.shouldPrintSchema)(o,n)?'"'.concat(o.name,'".'):"",'"').concat(a.name,'"."').concat(c.name,"\" IS '").concat(c.note.replace(/'/g,"''"),"'")}return t+=";\n"}))}},{key:"export",value:function(n){var t=n.database[1],a=new Set(Object.values(n.tables).map((function(e){return e.name}))),c=t.schemaIds.reduce((function(t,c){var u,l,s=n.schemas[c],d=s.tableIds,f=s.enumIds,m=s.refIds;(0,r.shouldPrintSchema)(s,n)&&t.schemas.push('CREATE SCHEMA "'.concat(s.name,'";\n')),o.default.isEmpty(f)||(u=t.enums).push.apply(u,i(e.exportEnums(f,n))),o.default.isEmpty(d)||(l=t.tables).push.apply(l,i(e.exportTables(d,n)));var p,b=o.default.flatten(d.map((function(e){return n.tables[e].indexIds})));o.default.isEmpty(b)||(p=t.indexes).push.apply(p,i(e.exportIndexes(b,n)));var y,v,h=o.default.flatten(d.map((function(e){var t=n.tables[e],a=t.fieldIds,o=t.note,r=a.filter((function(e){return n.fields[e].note})).map((function(n){return{type:"column",fieldId:n,tableId:e}}));return o?[{type:"table",tableId:e}].concat(r):r})));return o.default.isEmpty(h)||(y=t.comments).push.apply(y,i(e.exportComments(h,n))),o.default.isEmpty(m)||(v=t.refs).push.apply(v,i(e.exportRefs(m,n,a))),t}),{schemas:[],enums:[],tables:[],indexes:[],comments:[],refs:[]});return o.default.concat(c.schemas,c.enums,c.tables,c.indexes,c.comments,c.refs).join("\n")}}],(t=null)&&s(n.prototype,t),a&&s(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}();n.default=d},57135:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,o=(a=t(2543))&&a.__esModule?a:{default:a},r=t(81744);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return i(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function l(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(o=a.key,r=void 0,r=function(e,n){if("object"!==c(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!==c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(o,"string"),"symbol"===c(r)?r:String(r)),a)}var o,r}var s=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,a;return n=e,a=[{key:"getFieldLines",value:function(e,n){return n.tables[e].fieldIds.map((function(e){var t=n.fields[e],a="";if(t.enumId){var o=n.enums[t.enumId];a="[".concat(t.name,"] nvarchar(255) NOT NULL CHECK ([").concat(t.name,"] IN (");var r=o.valueIds.map((function(e){var t=n.enumValues[e];return"'".concat(t.name,"'")}));a+="".concat(r.join(", "),"))")}else a="[".concat(t.name,"] ").concat("varchar"!==t.type.type_name?t.type.type_name:"nvarchar(255)");return t.unique&&(a+=" UNIQUE"),t.pk&&(a+=" PRIMARY KEY"),t.not_null&&(a+=" NOT NULL"),t.increment&&(a+=" IDENTITY(1, 1)"),t.dbdefault&&("expression"===t.dbdefault.type?a+=" DEFAULT (".concat(t.dbdefault.value,")"):"string"===t.dbdefault.type?a+=" DEFAULT '".concat(t.dbdefault.value,"'"):a+=" DEFAULT (".concat(t.dbdefault.value,")")),a}))}},{key:"getCompositePKs",value:function(e,n){var t=n.tables[e];return(t.indexIds?t.indexIds.filter((function(e){return n.indexes[e].pk})):[]).map((function(e){var t=n.indexes[e],a="PRIMARY KEY",o=[];return t.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):"[".concat(t.value,"]"),o.push(a)})),a+=" (".concat(o.join(", "),")")}))}},{key:"getTableContentArr",value:function(n,t){return n.map((function(n){return{tableId:n,fieldContents:e.getFieldLines(n,t),compositePKs:e.getCompositePKs(n,t)}}))}},{key:"exportTables",value:function(n,t){return e.getTableContentArr(n,t).map((function(e){var n=[].concat(u(e.fieldContents),u(e.compositePKs)),a=t.tables[e.tableId],o=t.schemas[a.schemaId];return"CREATE TABLE ".concat((0,r.shouldPrintSchema)(o,t)?"[".concat(o.name,"]."):"","[").concat(a.name,"] (\n").concat(n.map((function(e){return"  ".concat(e)})).join(",\n"),"\n)\nGO\n")}))}},{key:"buildTableManyToMany",value:function(e,n,t,a,o){var c="CREATE TABLE ".concat((0,r.shouldPrintSchema)(a,o)?"[".concat(a.name,"]."):"","[").concat(t,"] (\n"),i=u(e.keys()).join("], ["),l=u(n.keys()).join("], [");return e.forEach((function(e,n){c+="  [".concat(n,"] ").concat(e,",\n")})),n.forEach((function(e,n){c+="  [".concat(n,"] ").concat(e,",\n")})),c+="  PRIMARY KEY ([".concat(i,"], [").concat(l,"])\n"),c+=");\nGO\n\n"}},{key:"buildForeignKeyManyToMany",value:function(e,n,t,a,o,c,i){var l=u(e.keys()).join("], [");return"ALTER TABLE ".concat((0,r.shouldPrintSchema)(o,i)?"[".concat(o.name,"]."):"","[").concat(t,"] ADD FOREIGN KEY ([").concat(l,"]) REFERENCES ").concat((0,r.shouldPrintSchema)(c,i)?"[".concat(c.name,"]."):"","[").concat(a,"] ").concat(n,";\nGO\n\n")}},{key:"buildFieldName",value:function(e,n){var t=e.map((function(e){return"[".concat(n.fields[e].name,"]")})).join(", ");return"(".concat(t,")")}},{key:"exportRefs",value:function(e,n,t){var a=this;return e.map((function(e){var o="",c=n.refs[e],u=c.endpointIds.findIndex((function(e){return"1"===n.endpoints[e].relation})),i=-1===u?0:u,l=c.endpointIds[1-i],s=c.endpointIds[i],d=n.endpoints[l],f=n.endpoints[s],m=n.fields[f.fieldIds[0]],p=n.tables[m.tableId],b=n.schemas[p.schemaId],y=a.buildFieldName(f.fieldIds,n,"mssql"),v=n.fields[d.fieldIds[0]],h=n.tables[v.tableId],E=n.schemas[h.schemaId],I=a.buildFieldName(d.fieldIds,n,"mssql");if(-1===u){var T=(0,r.buildJunctionFields1)(f.fieldIds,n),S=(0,r.buildJunctionFields2)(d.fieldIds,n,T),N=(0,r.buildNewTableName)(p.name,h.name,t);o+=a.buildTableManyToMany(T,S,N,b,n),o+=a.buildForeignKeyManyToMany(T,y,N,p.name,b,b,n),o+=a.buildForeignKeyManyToMany(S,I,N,h.name,b,E,n)}else o="ALTER TABLE ".concat((0,r.shouldPrintSchema)(E,n)?"[".concat(E.name,"]."):"","[").concat(h.name,"] ADD "),c.name&&(o+="CONSTRAINT [".concat(c.name,"] ")),o+="FOREIGN KEY ".concat(I," REFERENCES ").concat((0,r.shouldPrintSchema)(b,n)?"[".concat(b.name,"]."):"","[").concat(p.name,"] ").concat(y),c.onDelete&&(o+=" ON DELETE ".concat(c.onDelete.toUpperCase())),c.onUpdate&&(o+=" ON UPDATE ".concat(c.onUpdate.toUpperCase())),o+="\nGO\n";return o}))}},{key:"exportIndexes",value:function(e,n){return e.filter((function(e){return!n.indexes[e].pk})).map((function(e,t){var a=n.indexes[e],o=n.tables[a.tableId],c=n.schemas[o.schemaId],u="CREATE";a.unique&&(u+=" UNIQUE");var i=a.name?"[".concat(a.name,"]"):"".concat((0,r.shouldPrintSchema)(c,n)?"[".concat(c.name,"]."):"","[").concat(o.name,"_index_").concat(t,"]");u+=" INDEX ".concat(i," ON ").concat((0,r.shouldPrintSchema)(c,n)?"[".concat(c.name,"]."):"","[").concat(o.name,"]");var l=[];return a.columnIds.forEach((function(e){var t=n.indexColumns[e],a="";a="expression"===t.type?"(".concat(t.value,")"):'"'.concat(t.value,'"'),l.push(a)})),u+=" (".concat(l.join(", "),")"),u+="\nGO\n"}))}},{key:"exportComments",value:function(e,n){return e.map((function(e){var t=n.tables[e.tableId],a=n.schemas[t.schemaId],o="";switch(o="EXEC sp_addextendedproperty\n",e.type){case"table":o+="@name = N'Table_Description',\n",o+="@value = '".concat(t.note.replace(/'/g,"''"),"',\n"),o+="@level0type = N'Schema', @level0name = '".concat((0,r.shouldPrintSchema)(a,n)?"".concat(a.name):"dbo","',\n"),o+="@level1type = N'Table',  @level1name = '".concat(t.name,"';\n");break;case"column":var c=n.fields[e.fieldId];o+="@name = N'Column_Description',\n",o+="@value = '".concat(c.note.replace(/'/g,"''"),"',\n"),o+="@level0type = N'Schema', @level0name = '".concat((0,r.shouldPrintSchema)(a,n)?"".concat(a.name):"dbo","',\n"),o+="@level1type = N'Table',  @level1name = '".concat(t.name,"',\n"),o+="@level2type = N'Column', @level2name = '".concat(c.name,"';\n")}return o+="GO\n"}))}},{key:"export",value:function(n){var t=n.database[1],a=new Set(Object.values(n.tables).map((function(e){return e.name}))),c=t.schemaIds.reduce((function(t,c){var i,l=n.schemas[c],s=l.tableIds,d=l.refIds;(0,r.shouldPrintSchema)(l,n)&&t.schemas.push("CREATE SCHEMA [".concat(l.name,"]\nGO\n")),o.default.isEmpty(s)||(i=t.tables).push.apply(i,u(e.exportTables(s,n)));var f,m=o.default.flatten(s.map((function(e){return n.tables[e].indexIds})));o.default.isEmpty(m)||(f=t.indexes).push.apply(f,u(e.exportIndexes(m,n)));var p,b,y=o.default.flatten(s.map((function(e){var t=n.tables[e],a=t.fieldIds,o=t.note,r=a.filter((function(e){return n.fields[e].note})).map((function(n){return{type:"column",fieldId:n,tableId:e}}));return o?[{type:"table",tableId:e}].concat(r):r})));return o.default.isEmpty(y)||(p=t.comments).push.apply(p,u(e.exportComments(y,n))),o.default.isEmpty(d)||(b=t.refs).push.apply(b,u(e.exportRefs(d,n,a))),t}),{schemas:[],enums:[],tables:[],indexes:[],comments:[],refs:[]});return o.default.concat(c.schemas,c.enums,c.tables,c.indexes,c.comments,c.refs).join("\n")}}],(t=null)&&l(n.prototype,t),a&&l(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}();n.default=s},5717:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=r(t(82109)),o=r(t(24783));function r(e){return e&&e.__esModule?e:{default:e}}var c={export:function(e,n){var t=(new o.default).parse(e,"dbmlv2");return a.default.export(t.normalize(),n)}};n.default=c},81744:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.buildJunctionFields1=function(e,n){var t=new Map;return e.map((function(e){return t.set("".concat(n.tables[n.fields[e].tableId].name,"_").concat(n.fields[e].name),n.fields[e].type.type_name)})),t},n.buildJunctionFields2=function(e,n,t){var a=new Map;return e.forEach((function(e){for(var o="".concat(n.tables[n.fields[e].tableId].name,"_").concat(n.fields[e].name),r=1;t.has(o);)o="".concat(n.tables[n.fields[e].tableId].name,"_").concat(n.fields[e].name,"(").concat(r,")"),r+=1;a.set(o,n.fields[e].type.type_name)})),a},n.buildNewTableName=function(e,n,t){var a="".concat(e,"_").concat(n),o=1;for(;t.has(a);)a="".concat(e,"_").concat(n,"(").concat(o,")"),o+=1;return t.add(a),a},n.buildUniqueTableName=function(e,n,t,a){var o="".concat(n,"_").concat(t),r=1,c=a.get(e);if(!c)return o;for(;c.has(o);)o="".concat(n,"_").concat(t,"(").concat(r,")"),r+=1;return o},n.escapeObjectName=function(e,n){if(!e)return"";var t="";switch(n){case"mysql":t="`";break;case"postgres":case"oracle":t='"'}return"".concat(t).concat(e).concat(t)},n.hasWhiteSpace=function(e){return/\s/g.test(e)},n.shouldPrintSchema=function(e,n){return e.name!==a.DEFAULT_SCHEMA_NAME||e.name===a.DEFAULT_SCHEMA_NAME&&n.database[1].hasDefaultSchema};var a=t(8974)},39802:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=t(80764),o=c(t(24783)),r=c(t(82109));function c(e){return e&&e.__esModule?e:{default:e}}var u={import:function(e,n){var t=(new o.default).parse(e,n);return r.default.export(t.normalize(),"dbml")},generateDbml:function(e){var n=(0,a.generateDatabase)(e);return r.default.export(n.normalize(),"dbml")}};n.default=u}}]);
