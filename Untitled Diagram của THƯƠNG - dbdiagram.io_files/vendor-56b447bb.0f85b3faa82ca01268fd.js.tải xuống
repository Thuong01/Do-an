!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4bc00be2-9fe8-44d4-895b-18d50a1f98ad",e._sentryDebugIdIdentifier="sentry-dbid-4bc00be2-9fe8-44d4-895b-18d50a1f98ad")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"13ad4a0c312011ebb49f3e8dc8f97be809f60d04"},(self.webpackChunkschema_diagram_vue=self.webpackChunkschema_diagram_vue||[]).push([[8186],{11608:function(e,t,i){i.d(t,{GP:function(){return l},LM:function(){return s},Uv:function(){return c},kI:function(){return u},nt:function(){return r},or:function(){return h},qL:function(){return a},vo:function(){return d}});var n=i(16844),o=i(28061);class s{constructor(e,t,i,n){this._viewportBrand=void 0,this.top=0|e,this.left=0|t,this.width=0|i,this.height=0|n}}class r{constructor(e,t){this.tabSize=e,this.data=t}}class l{constructor(e,t,i,n,o,s,r){this._viewLineDataBrand=void 0,this.content=e,this.continuesWithWrappedLine=t,this.minColumn=i,this.maxColumn=n,this.startVisibleColumn=o,this.tokens=s,this.inlineDecorations=r}}class a{constructor(e,t,i,n,o,s,r,l,u,h){this.minColumn=e,this.maxColumn=t,this.content=i,this.continuesWithWrappedLine=n,this.isBasicASCII=a.isBasicASCII(i,s),this.containsRTL=a.containsRTL(i,this.isBasicASCII,o),this.tokens=r,this.inlineDecorations=l,this.tabSize=u,this.startVisibleColumn=h}static isBasicASCII(e,t){return!t||n.aC(e)}static containsRTL(e,t,i){return!(t||!i)&&n.E_(e)}}class u{constructor(e,t,i){this.range=e,this.inlineClassName=t,this.type=i}}class h{constructor(e,t,i,n){this.startOffset=e,this.endOffset=t,this.inlineClassName=i,this.inlineClassNameAffectsLetterSpacing=n}toInlineDecoration(e){return new u(new o.Q(e,this.startOffset+1,e,this.endOffset+1),this.inlineClassName,this.inlineClassNameAffectsLetterSpacing?3:0)}}class d{constructor(e,t){this._viewModelDecorationBrand=void 0,this.range=e,this.options=t}}class c{constructor(e,t,i){this.color=e,this.zIndex=t,this.data=i}static cmp(e,t){return e.zIndex===t.zIndex?e.color<t.color?-1:e.color>t.color?1:0:e.zIndex-t.zIndex}}},6167:function(e,t,i){i.d(t,{v:function(){return l}});var n=i(2106),o=i(10998),s=i(95444),r=i(47317);class l extends o.jG{constructor(){super(),this._onDidChange=new n.vl,this.onDidChange=this._onDidChange.event,this._updateColorMap(),this._register(r.dG.onDidChange((e=>{e.changedColorMap&&this._updateColorMap()})))}static getInstance(){return this._INSTANCE||(this._INSTANCE=(0,o.lC)(new l)),this._INSTANCE}_updateColorMap(){const e=r.dG.getColorMap();if(!e)return this._colors=[s.D.Empty],void(this._backgroundIsLight=!0);this._colors=[s.D.Empty];for(let t=1;t<e.length;t++){const i=e[t].rgba;this._colors[t]=new s.D(i.r,i.g,i.b,Math.round(255*i.a))}const t=e[2].getRelativeLuminance();this._backgroundIsLight=t>=.5,this._onDidChange.fire(void 0)}getColor(e){return(e<1||e>=this._colors.length)&&(e=2),this._colors[e]}backgroundIsLight(){return this._backgroundIsLight}}l._INSTANCE=null},61435:function(e,t,i){i.d(t,{J:function(){return l}});var n=i(16844),o=i(27454),s=i(83455),r=i(23996);class l{constructor(e,t){this.classifier=new a(e,t)}static create(e){return new l(e.get(122),e.get(121))}createLineBreaksComputer(e,t,i,n){const o=[],s=[],r=[];return{addRequest:(e,t,i)=>{o.push(e),s.push(t),r.push(i)},finalize:()=>{const l=e.typicalFullwidthCharacterWidth/e.typicalHalfwidthCharacterWidth,a=[];for(let e=0,u=o.length;e<u;e++){const u=s[e],h=r[e];!h||h.injectionOptions||u?a[e]=c(this.classifier,o[e],u,t,i,l,n):a[e]=d(this.classifier,h,o[e],t,i,l,n)}return u.length=0,h.length=0,a}}}}class a extends o.V{constructor(e,t){super(0);for(let t=0;t<e.length;t++)this.set(e.charCodeAt(t),1);for(let e=0;e<t.length;e++)this.set(t.charCodeAt(e),2)}get(e){return e>=0&&e<256?this._asciiMap[e]:e>=12352&&e<=12543||e>=13312&&e<=19903||e>=19968&&e<=40959?3:this._map.get(e)||this._defaultValue}}let u=[],h=[];function d(e,t,i,o,s,r,l){if(-1===s)return null;const a=i.length;if(a<=1)return null;const d=t.breakOffsets,c=t.breakOffsetsVisibleColumn,m=w(i,o,s,r,l),f=s-m,p=u,C=h;let _=0,V=0,b=0,v=s;const N=d.length;let M=0;if(M>=0){let e=Math.abs(c[M]-v);for(;M+1<N;){const t=Math.abs(c[M+1]-v);if(t>=e)break;e=t,M++}}for(;M<N;){let t=M<0?0:d[M],s=M<0?0:c[M];V>t&&(t=V,s=b);let l=0,u=0,h=0,m=0;if(s<=v){let w=s,b=0===t?0:i.charCodeAt(t-1),N=0===t?0:e.get(b),M=!0;for(let s=t;s<a;s++){const t=s,a=i.charCodeAt(s);let d,c;if(n.pc(a)?(s++,d=0,c=2):(d=e.get(a),c=g(a,w,o,r)),t>V&&L(b,N,a,d)&&(l=t,u=w),w+=c,w>v){t>V?(h=t,m=w-c):(h=s+1,m=w),w-u>f&&(l=0),M=!1;break}b=a,N=d}if(M){_>0&&(p[_]=d[d.length-1],C[_]=c[d.length-1],_++);break}}if(0===l){let a=s,d=i.charCodeAt(t),c=e.get(d),w=!1;for(let o=t-1;o>=V;o--){const t=o+1,s=i.charCodeAt(o);if(9===s){w=!0;break}let g,p;if(n.LJ(s)?(o--,g=0,p=2):(g=e.get(s),p=n.ne(s)?r:1),a<=v){if(0===h&&(h=t,m=a),a<=v-f)break;if(L(s,g,d,c)){l=t,u=a;break}}a-=p,d=s,c=g}if(0!==l){const e=f-(m-u);if(e<=o){const t=i.charCodeAt(h);let s;s=n.pc(t)?2:g(t,m,o,r),e-s<0&&(l=0)}}if(w){M--;continue}}if(0===l&&(l=h,u=m),l<=V){const e=i.charCodeAt(V);n.pc(e)?(l=V+2,u=b+2):(l=V+1,u=b+g(e,b,o,r))}for(V=l,p[_]=l,b=u,C[_]=u,_++,v=u+f;M<0||M<N&&c[M]<u;)M++;let w=Math.abs(c[M]-v);for(;M+1<N;){const e=Math.abs(c[M+1]-v);if(e>=w)break;w=e,M++}}return 0===_?null:(p.length=_,C.length=_,u=t.breakOffsets,h=t.breakOffsetsVisibleColumn,t.breakOffsets=p,t.breakOffsetsVisibleColumn=C,t.wrappedTextIndentLength=m,t)}function c(e,t,i,o,l,a,u){const h=s.uK.applyInjectedText(t,i);let d,c;if(i&&i.length>0?(d=i.map((e=>e.options)),c=i.map((e=>e.column-1))):(d=null,c=null),-1===l)return d?new r.R_(c,d,[h.length],[],0):null;const m=h.length;if(m<=1)return d?new r.R_(c,d,[h.length],[],0):null;const f=w(h,o,l,a,u),p=l-f,C=[],_=[];let V=0,b=0,v=0,N=l,M=h.charCodeAt(0),P=e.get(M),I=g(M,0,o,a),D=1;n.pc(M)&&(I+=1,M=h.charCodeAt(1),P=e.get(M),D++);for(let t=D;t<m;t++){const i=t,s=h.charCodeAt(t);let r,l;n.pc(s)?(t++,r=0,l=2):(r=e.get(s),l=g(s,I,o,a)),L(M,P,s,r)&&(b=i,v=I),I+=l,I>N&&((0===b||I-v>p)&&(b=i,v=I-l),C[V]=b,_[V]=v,V++,N=v+p,b=0),M=s,P=r}return 0!==V||i&&0!==i.length?(C[V]=m,_[V]=I,new r.R_(c,d,C,_,f)):null}function g(e,t,i,o){return 9===e?i-t%i:n.ne(e)||e<32?o:1}function m(e,t){return t-e%t}function L(e,t,i,n){return 32!==i&&(2===t&&2!==n||1!==t&&1===n||3===t&&2!==n||3===n&&1!==t)}function w(e,t,i,o,s){let r=0;if(0!==s){const l=n.HG(e);if(-1!==l){for(let i=0;i<l;i++){r+=9===e.charCodeAt(i)?m(r,t):1}const n=3===s?2:2===s?1:0;for(let e=0;e<n;e++){r+=m(r,t)}r+o>i&&(r=0)}}return r}},96803:function(e,t,i){i.d(t,{iE:function(){return o},rW:function(){return s}});class n{constructor(e,t,i){this._colorZoneBrand=void 0,this.from=0|e,this.to=0|t,this.colorId=0|i}static compare(e,t){return e.colorId===t.colorId?e.from===t.from?e.to-t.to:e.from-t.from:e.colorId-t.colorId}}class o{constructor(e,t,i,n){this._overviewRulerZoneBrand=void 0,this.startLineNumber=e,this.endLineNumber=t,this.heightInLines=i,this.color=n,this._colorZone=null}static compare(e,t){return e.color===t.color?e.startLineNumber===t.startLineNumber?e.heightInLines===t.heightInLines?e.endLineNumber-t.endLineNumber:e.heightInLines-t.heightInLines:e.startLineNumber-t.startLineNumber:e.color<t.color?-1:1}setColorZone(e){this._colorZone=e}getColorZones(){return this._colorZone}}class s{constructor(e){this._getVerticalOffsetForLine=e,this._zones=[],this._colorZonesInvalid=!1,this._lineHeight=0,this._domWidth=0,this._domHeight=0,this._outerHeight=0,this._pixelRatio=1,this._lastAssignedId=0,this._color2Id=Object.create(null),this._id2Color=[]}getId2Color(){return this._id2Color}setZones(e){this._zones=e,this._zones.sort(o.compare)}setLineHeight(e){return this._lineHeight!==e&&(this._lineHeight=e,this._colorZonesInvalid=!0,!0)}setPixelRatio(e){this._pixelRatio=e,this._colorZonesInvalid=!0}getDOMWidth(){return this._domWidth}getCanvasWidth(){return this._domWidth*this._pixelRatio}setDOMWidth(e){return this._domWidth!==e&&(this._domWidth=e,this._colorZonesInvalid=!0,!0)}getDOMHeight(){return this._domHeight}getCanvasHeight(){return this._domHeight*this._pixelRatio}setDOMHeight(e){return this._domHeight!==e&&(this._domHeight=e,this._colorZonesInvalid=!0,!0)}getOuterHeight(){return this._outerHeight}setOuterHeight(e){return this._outerHeight!==e&&(this._outerHeight=e,this._colorZonesInvalid=!0,!0)}resolveColorZones(){const e=this._colorZonesInvalid,t=Math.floor(this._lineHeight),i=Math.floor(this.getCanvasHeight()),o=i/Math.floor(this._outerHeight),s=Math.floor(4*this._pixelRatio/2),r=[];for(let l=0,a=this._zones.length;l<a;l++){const a=this._zones[l];if(!e){const e=a.getColorZones();if(e){r.push(e);continue}}const u=this._getVerticalOffsetForLine(a.startLineNumber),h=0===a.heightInLines?this._getVerticalOffsetForLine(a.endLineNumber)+t:u+a.heightInLines*t,d=Math.floor(o*u),c=Math.floor(o*h);let g=Math.floor((d+c)/2),m=c-g;m<s&&(m=s),g-m<0&&(g=m),g+m>i&&(g=i-m);const L=a.color;let w=this._color2Id[L];w||(w=++this._lastAssignedId,this._color2Id[L]=w,this._id2Color[w]=L);const f=new n(g-m,g+m,w);a.setColorZone(f),r.push(f)}return this._colorZonesInvalid=!1,r.sort(n.compare),r}}},60499:function(e,t,i){i.d(t,{r:function(){return o}});var n=i(82732);class o{constructor(e,t,i){this.configuration=e,this.theme=new n.v(t),this.viewModel=i,this.viewLayout=i.viewLayout}addEventHandler(e){this.viewModel.addViewEventHandler(e)}removeEventHandler(e){this.viewModel.removeViewEventHandler(e)}}},31430:function(e,t,i){i.d(t,{GN:function(){return a},UB:function(){return l},a6:function(){return u},wc:function(){return h}});var n=i(15365),o=i(28061),s=i(11608),r=i(66476);class l{constructor(e,t,i,n,o){this.editorId=e,this.model=t,this.configuration=i,this._linesCollection=n,this._coordinatesConverter=o,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(e){const t=e.id;let i=this._decorationsCache[t];if(!i){const r=e.range,l=e.options;let a;if(l.isWholeLine){const e=this._coordinatesConverter.convertModelPositionToViewPosition(new n.y(r.startLineNumber,1),0),t=this._coordinatesConverter.convertModelPositionToViewPosition(new n.y(r.endLineNumber,this.model.getLineMaxColumn(r.endLineNumber)),1);a=new o.Q(e.lineNumber,e.column,t.lineNumber,t.column)}else a=this._coordinatesConverter.convertModelRangeToViewRange(r,1);i=new s.vo(a,l),this._decorationsCache[t]=i}return i}getDecorationsViewportData(e){let t=null!==this._cachedModelDecorationsResolver;return t=t&&e.equalsRange(this._cachedModelDecorationsResolverViewRange),t||(this._cachedModelDecorationsResolver=this._getDecorationsInRange(e),this._cachedModelDecorationsResolverViewRange=e),this._cachedModelDecorationsResolver}getInlineDecorationsOnLine(e){const t=new o.Q(e,this._linesCollection.getViewLineMinColumn(e),e,this._linesCollection.getViewLineMaxColumn(e));return this._getDecorationsInRange(t).inlineDecorations[0]}_getDecorationsInRange(e){const t=this._linesCollection.getDecorationsInRange(e,this.editorId,(0,r.$C)(this.configuration.options)),i=e.startLineNumber,n=e.endLineNumber,l=[];let u=0;const h=[];for(let e=i;e<=n;e++)h[e-i]=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],d=r.options;if(!a(this.model,r))continue;const c=this._getOrCreateViewModelDecoration(r),g=c.range;if(l[u++]=c,d.inlineClassName){const e=new s.kI(g,d.inlineClassName,d.inlineClassNameAffectsLetterSpacing?3:0),t=Math.max(i,g.startLineNumber),o=Math.min(n,g.endLineNumber);for(let n=t;n<=o;n++)h[n-i].push(e)}if(d.beforeContentClassName&&i<=g.startLineNumber&&g.startLineNumber<=n){const e=new s.kI(new o.Q(g.startLineNumber,g.startColumn,g.startLineNumber,g.startColumn),d.beforeContentClassName,1);h[g.startLineNumber-i].push(e)}if(d.afterContentClassName&&i<=g.endLineNumber&&g.endLineNumber<=n){const e=new s.kI(new o.Q(g.endLineNumber,g.endColumn,g.endLineNumber,g.endColumn),d.afterContentClassName,2);h[g.endLineNumber-i].push(e)}}return{decorations:l,inlineDecorations:h}}}function a(e,t){return(!t.options.hideInCommentTokens||!u(e,t))&&(!t.options.hideInStringTokens||!h(e,t))}function u(e,t){return d(e,t.range,(e=>1===e))}function h(e,t){return d(e,t.range,(e=>2===e))}function d(e,t,i){for(let n=t.startLineNumber;n<=t.endLineNumber;n++){const o=e.tokenization.getLineTokens(n),s=n===t.startLineNumber,r=n===t.endLineNumber;let l=s?o.findTokenIndexAtOffset(t.startColumn-1):0;for(;l<o.getCount();){if(r){if(o.getStartOffset(l)>t.endColumn-1)break}if(!i(o.getStandardTokenType(l)))return!1;l++}}return!0}},4140:function(e,t,i){i.d(t,{J:function(){return W}});var n=i(13338),o=i(65958),s=i(94901),r=i(10998),l=i(63339),a=i(16844),u=i(66476),h=i(84296),d=i(29895),c=i(15365),g=i(28061),m=i(83455),L=i(47317),w=i(54957),f=i(1458),p=i(45744),C=i(2262),_=i(6167),V=i(11608),b=i(31430),v=i(22731),N=i(60779),M=i(20491),P=i(57445);function I(e,t){return null===e?t?T.INSTANCE:E.INSTANCE:new D(e,t)}class D{constructor(e,t){this._projectionData=e,this._isVisible=t}isVisible(){return this._isVisible}setVisible(e){return this._isVisible=e,this}getProjectionData(){return this._projectionData}getViewLineCount(){return this._isVisible?this._projectionData.getOutputLineCount():0}getViewLineContent(e,t,i){this._assertVisible();const n=i>0?this._projectionData.breakOffsets[i-1]:0,o=this._projectionData.breakOffsets[i];let s;if(null!==this._projectionData.injectionOffsets){const i=this._projectionData.injectionOffsets.map(((e,t)=>new m.uK(0,0,e+1,this._projectionData.injectionOptions[t],0)));s=m.uK.applyInjectedText(e.getLineContent(t),i).substring(n,o)}else s=e.getValueInRange({startLineNumber:t,startColumn:n+1,endLineNumber:t,endColumn:o+1});return i>0&&(s=S(this._projectionData.wrappedTextIndentLength)+s),s}getViewLineLength(e,t,i){return this._assertVisible(),this._projectionData.getLineLength(i)}getViewLineMinColumn(e,t,i){return this._assertVisible(),this._projectionData.getMinOutputOffset(i)+1}getViewLineMaxColumn(e,t,i){return this._assertVisible(),this._projectionData.getMaxOutputOffset(i)+1}getViewLineData(e,t,i){const n=new Array;return this.getViewLinesData(e,t,i,1,0,[!0],n),n[0]}getViewLinesData(e,t,i,n,o,s,r){this._assertVisible();const l=this._projectionData,a=l.injectionOffsets,u=l.injectionOptions;let h,d=null;if(a){d=[];let e=0,t=0;for(let i=0;i<l.getOutputLineCount();i++){const n=new Array;d[i]=n;const o=i>0?l.breakOffsets[i-1]:0,s=l.breakOffsets[i];for(;t<a.length;){const r=u[t].content.length,h=a[t]+e,d=h+r;if(h>s)break;if(o<d){const e=u[t];if(e.inlineClassName){const t=i>0?l.wrappedTextIndentLength:0,r=t+Math.max(h-o,0),a=t+Math.min(d-o,s);r!==a&&n.push(new V.or(r,a,e.inlineClassName,e.inlineClassNameAffectsLetterSpacing))}}if(!(d<=s))break;e+=r,t++}}}h=a?e.tokenization.getLineTokens(t).withInserted(a.map(((e,t)=>({offset:e,text:u[t].content,tokenMetadata:P.f.defaultTokenMetadata})))):e.tokenization.getLineTokens(t);for(let e=i;e<i+n;e++){const t=o+e-i;s[t]?r[t]=this._getViewLineData(h,d?d[e]:null,e):r[t]=null}}_getViewLineData(e,t,i){this._assertVisible();const n=this._projectionData,o=i>0?n.wrappedTextIndentLength:0,s=i>0?n.breakOffsets[i-1]:0,r=n.breakOffsets[i],l=e.sliceAndInflate(s,r,o);let a=l.getLineContent();i>0&&(a=S(n.wrappedTextIndentLength)+a);const u=this._projectionData.getMinOutputOffset(i)+1,h=a.length+1,d=i+1<this.getViewLineCount(),c=0===i?0:n.breakOffsetsVisibleColumn[i-1];return new V.GP(a,d,u,h,c,l,t)}getModelColumnOfViewPosition(e,t){return this._assertVisible(),this._projectionData.translateToInputOffset(e,t-1)+1}getViewPositionOfModelPosition(e,t,i=2){this._assertVisible();return this._projectionData.translateToOutputPosition(t-1,i).toPosition(e)}getViewLineNumberOfModelPosition(e,t){this._assertVisible();return e+this._projectionData.translateToOutputPosition(t-1).outputLineIndex}normalizePosition(e,t,i){const n=t.lineNumber-e;return this._projectionData.normalizeOutputPosition(e,t.column-1,i).toPosition(n)}getInjectedTextAt(e,t){return this._projectionData.getInjectedText(e,t-1)}_assertVisible(){if(!this._isVisible)throw new Error("Not supported")}}class T{constructor(){}isVisible(){return!0}setVisible(e){return e?this:E.INSTANCE}getProjectionData(){return null}getViewLineCount(){return 1}getViewLineContent(e,t,i){return e.getLineContent(t)}getViewLineLength(e,t,i){return e.getLineLength(t)}getViewLineMinColumn(e,t,i){return e.getLineMinColumn(t)}getViewLineMaxColumn(e,t,i){return e.getLineMaxColumn(t)}getViewLineData(e,t,i){const n=e.tokenization.getLineTokens(t),o=n.getLineContent();return new V.GP(o,!1,1,o.length+1,0,n.inflate(),null)}getViewLinesData(e,t,i,n,o,s,r){s[o]?r[o]=this.getViewLineData(e,t,0):r[o]=null}getModelColumnOfViewPosition(e,t){return t}getViewPositionOfModelPosition(e,t){return new c.y(e,t)}getViewLineNumberOfModelPosition(e,t){return e}normalizePosition(e,t,i){return t}getInjectedTextAt(e,t){return null}}T.INSTANCE=new T;class E{constructor(){}isVisible(){return!1}setVisible(e){return e?T.INSTANCE:this}getProjectionData(){return null}getViewLineCount(){return 0}getViewLineContent(e,t,i){throw new Error("Not supported")}getViewLineLength(e,t,i){throw new Error("Not supported")}getViewLineMinColumn(e,t,i){throw new Error("Not supported")}getViewLineMaxColumn(e,t,i){throw new Error("Not supported")}getViewLineData(e,t,i){throw new Error("Not supported")}getViewLinesData(e,t,i,n,o,s,r){throw new Error("Not supported")}getModelColumnOfViewPosition(e,t){throw new Error("Not supported")}getViewPositionOfModelPosition(e,t){throw new Error("Not supported")}getViewLineNumberOfModelPosition(e,t){throw new Error("Not supported")}normalizePosition(e,t,i){throw new Error("Not supported")}getInjectedTextAt(e,t){throw new Error("Not supported")}}E.INSTANCE=new E;const y=[""];function S(e){if(e>=y.length)for(let t=1;t<=e;t++)y[t]=x(t);return y[e]}function x(e){return new Array(e+1).join(" ")}var R=i(56158);class O{constructor(e,t,i,n,o,s,r,l,a){this._editorId=e,this.model=t,this._validModelVersionId=-1,this._domLineBreaksComputerFactory=i,this._monospaceLineBreaksComputerFactory=n,this.fontInfo=o,this.tabSize=s,this.wrappingStrategy=r,this.wrappingColumn=l,this.wrappingIndent=a,this._constructLines(!0,null)}dispose(){this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[])}createCoordinatesConverter(){return new A(this)}_constructLines(e,t){this.modelLineProjections=[],e&&(this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[]));const i=this.model.getLinesContent(),o=this.model.getInjectedTextDecorations(this._editorId),s=i.length,r=this.createLineBreaksComputer(),l=new n.j3(m.uK.fromDecorations(o));for(let e=0;e<s;e++){const n=l.takeWhile((t=>t.lineNumber===e+1));r.addRequest(i[e],n,t?t[e]:null)}const a=r.finalize(),u=[],h=this.hiddenAreasDecorationIds.map((e=>this.model.getDecorationRange(e))).sort(g.Q.compareRangesUsingStarts);let d=1,c=0,L=-1,w=L+1<h.length?c+1:s+2;for(let e=0;e<s;e++){const t=e+1;t===w&&(L++,d=h[L].startLineNumber,c=h[L].endLineNumber,w=L+1<h.length?c+1:s+2);const i=t>=d&&t<=c,n=I(a[e],!i);u[e]=n.getViewLineCount(),this.modelLineProjections[e]=n}this._validModelVersionId=this.model.getVersionId(),this.projectedModelLineLineCounts=new R.c2(u)}getHiddenAreas(){return this.hiddenAreasDecorationIds.map((e=>this.model.getDecorationRange(e)))}setHiddenAreas(e){const t=function(e){if(0===e.length)return[];const t=e.slice();t.sort(g.Q.compareRangesUsingStarts);const i=[];let n=t[0].startLineNumber,o=t[0].endLineNumber;for(let e=1,s=t.length;e<s;e++){const s=t[e];s.startLineNumber>o+1?(i.push(new g.Q(n,1,o,1)),n=s.startLineNumber,o=s.endLineNumber):s.endLineNumber>o&&(o=s.endLineNumber)}return i.push(new g.Q(n,1,o,1)),i}(e.map((e=>this.model.validateRange(e)))),i=this.hiddenAreasDecorationIds.map((e=>this.model.getDecorationRange(e))).sort(g.Q.compareRangesUsingStarts);if(t.length===i.length){let e=!1;for(let n=0;n<t.length;n++)if(!t[n].equalsRange(i[n])){e=!0;break}if(!e)return!1}const n=t.map((e=>({range:e,options:M.kI.EMPTY})));this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,n);const o=t;let s=1,r=0,l=-1,a=l+1<o.length?r+1:this.modelLineProjections.length+2,u=!1;for(let e=0;e<this.modelLineProjections.length;e++){const t=e+1;t===a&&(l++,s=o[l].startLineNumber,r=o[l].endLineNumber,a=l+1<o.length?r+1:this.modelLineProjections.length+2);let i=!1;if(t>=s&&t<=r?this.modelLineProjections[e].isVisible()&&(this.modelLineProjections[e]=this.modelLineProjections[e].setVisible(!1),i=!0):(u=!0,this.modelLineProjections[e].isVisible()||(this.modelLineProjections[e]=this.modelLineProjections[e].setVisible(!0),i=!0)),i){const t=this.modelLineProjections[e].getViewLineCount();this.projectedModelLineLineCounts.setValue(e,t)}}return u||this.setHiddenAreas([]),!0}modelPositionIsVisible(e,t){return!(e<1||e>this.modelLineProjections.length)&&this.modelLineProjections[e-1].isVisible()}getModelLineViewLineCount(e){return e<1||e>this.modelLineProjections.length?1:this.modelLineProjections[e-1].getViewLineCount()}setTabSize(e){return this.tabSize!==e&&(this.tabSize=e,this._constructLines(!1,null),!0)}setWrappingSettings(e,t,i,n){const o=this.fontInfo.equals(e),s=this.wrappingStrategy===t,r=this.wrappingColumn===i,l=this.wrappingIndent===n;if(o&&s&&r&&l)return!1;const a=o&&s&&!r&&l;this.fontInfo=e,this.wrappingStrategy=t,this.wrappingColumn=i,this.wrappingIndent=n;let u=null;if(a){u=[];for(let e=0,t=this.modelLineProjections.length;e<t;e++)u[e]=this.modelLineProjections[e].getProjectionData()}return this._constructLines(!1,u),!0}createLineBreaksComputer(){return("advanced"===this.wrappingStrategy?this._domLineBreaksComputerFactory:this._monospaceLineBreaksComputerFactory).createLineBreaksComputer(this.fontInfo,this.tabSize,this.wrappingColumn,this.wrappingIndent)}onModelFlushed(){this._constructLines(!0,null)}onModelLinesDeleted(e,t,i){if(!e||e<=this._validModelVersionId)return null;const n=1===t?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,o=this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections.splice(t-1,i-t+1),this.projectedModelLineLineCounts.removeValues(t-1,i-t+1),new p.Uf(n,o)}onModelLinesInserted(e,t,i,n){if(!e||e<=this._validModelVersionId)return null;const o=t>2&&!this.modelLineProjections[t-2].isVisible(),s=1===t?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1;let r=0;const l=[],a=[];for(let e=0,t=n.length;e<t;e++){const t=I(n[e],!o);l.push(t);const i=t.getViewLineCount();r+=i,a[e]=i}return this.modelLineProjections=this.modelLineProjections.slice(0,t-1).concat(l).concat(this.modelLineProjections.slice(t-1)),this.projectedModelLineLineCounts.insertValues(t-1,a),new p.rZ(s,s+r-1)}onModelLineChanged(e,t,i){if(null!==e&&e<=this._validModelVersionId)return[!1,null,null,null];const n=t-1,o=this.modelLineProjections[n].getViewLineCount(),s=I(i,this.modelLineProjections[n].isVisible());this.modelLineProjections[n]=s;const r=this.modelLineProjections[n].getViewLineCount();let l=!1,a=0,u=-1,h=0,d=-1,c=0,g=-1;o>r?(a=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,u=a+r-1,c=u+1,g=c+(o-r)-1,l=!0):o<r?(a=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,u=a+o-1,h=u+1,d=h+(r-o)-1,l=!0):(a=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,u=a+r-1),this.projectedModelLineLineCounts.setValue(n,r);return[l,a<=u?new p.bu(a,u-a+1):null,h<=d?new p.rZ(h,d):null,c<=g?new p.Uf(c,g):null]}acceptVersionId(e){this._validModelVersionId=e,1!==this.modelLineProjections.length||this.modelLineProjections[0].isVisible()||this.setHiddenAreas([])}getViewLineCount(){return this.projectedModelLineLineCounts.getTotalSum()}_toValidViewLineNumber(e){if(e<1)return 1;const t=this.getViewLineCount();return e>t?t:0|e}getActiveIndentGuide(e,t,i){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t),i=this._toValidViewLineNumber(i);const n=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),o=this.convertViewPositionToModelPosition(t,this.getViewLineMinColumn(t)),s=this.convertViewPositionToModelPosition(i,this.getViewLineMinColumn(i)),r=this.model.guides.getActiveIndentGuide(n.lineNumber,o.lineNumber,s.lineNumber),l=this.convertModelPositionToViewPosition(r.startLineNumber,1),a=this.convertModelPositionToViewPosition(r.endLineNumber,this.model.getLineMaxColumn(r.endLineNumber));return{startLineNumber:l.lineNumber,endLineNumber:a.lineNumber,indent:r.indent}}getViewLineInfo(e){e=this._toValidViewLineNumber(e);const t=this.projectedModelLineLineCounts.getIndexOf(e-1),i=t.index,n=t.remainder;return new j(i+1,n)}getMinColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getMaxColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getModelStartPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],i=t.getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),n=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,i);return new c.y(e.modelLineNumber,n)}getModelEndPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],i=t.getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),n=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,i);return new c.y(e.modelLineNumber,n)}getViewLineInfosGroupedByModelRanges(e,t){const i=this.getViewLineInfo(e),n=this.getViewLineInfo(t),o=new Array;let s=this.getModelStartPositionOfViewLine(i),r=new Array;for(let e=i.modelLineNumber;e<=n.modelLineNumber;e++){const t=this.modelLineProjections[e-1];if(t.isVisible()){const o=e===i.modelLineNumber?i.modelLineWrappedLineIdx:0,s=e===n.modelLineNumber?n.modelLineWrappedLineIdx+1:t.getViewLineCount();for(let t=o;t<s;t++)r.push(new j(e,t))}if(!t.isVisible()&&s){const t=new c.y(e-1,this.model.getLineMaxColumn(e-1)+1),i=g.Q.fromPositions(s,t);o.push(new k(i,r)),r=[],s=null}else t.isVisible()&&!s&&(s=new c.y(e,1))}if(s){const e=g.Q.fromPositions(s,this.getModelEndPositionOfViewLine(n));o.push(new k(e,r))}return o}getViewLinesBracketGuides(e,t,i,n){const o=i?this.convertViewPositionToModelPosition(i.lineNumber,i.column):null,s=[];for(const i of this.getViewLineInfosGroupedByModelRanges(e,t)){const e=i.modelRange.startLineNumber,t=this.model.guides.getLinesBracketGuides(e,i.modelRange.endLineNumber,o,n);for(const n of i.viewLines){const i=t[n.modelLineNumber-e].map((e=>{if(-1!==e.forWrappedLinesAfterColumn){if(this.modelLineProjections[n.modelLineNumber-1].getViewPositionOfModelPosition(0,e.forWrappedLinesAfterColumn).lineNumber>=n.modelLineWrappedLineIdx)return}if(-1!==e.forWrappedLinesBeforeOrAtColumn){if(this.modelLineProjections[n.modelLineNumber-1].getViewPositionOfModelPosition(0,e.forWrappedLinesBeforeOrAtColumn).lineNumber<n.modelLineWrappedLineIdx)return}if(!e.horizontalLine)return e;let t=-1;if(-1!==e.column){const i=this.modelLineProjections[n.modelLineNumber-1].getViewPositionOfModelPosition(0,e.column);if(i.lineNumber===n.modelLineWrappedLineIdx)t=i.column;else if(i.lineNumber<n.modelLineWrappedLineIdx)t=this.getMinColumnOfViewLine(n);else if(i.lineNumber>n.modelLineWrappedLineIdx)return}const i=this.convertModelPositionToViewPosition(n.modelLineNumber,e.horizontalLine.endColumn),o=this.modelLineProjections[n.modelLineNumber-1].getViewPositionOfModelPosition(0,e.horizontalLine.endColumn);return o.lineNumber===n.modelLineWrappedLineIdx?new N.TH(e.visibleColumn,t,e.className,new N.pv(e.horizontalLine.top,i.column),-1,-1):o.lineNumber<n.modelLineWrappedLineIdx||-1!==e.visibleColumn?void 0:new N.TH(e.visibleColumn,t,e.className,new N.pv(e.horizontalLine.top,this.getMaxColumnOfViewLine(n)),-1,-1)}));s.push(i.filter((e=>!!e)))}}return s}getViewLinesIndentGuides(e,t){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const i=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),n=this.convertViewPositionToModelPosition(t,this.getViewLineMaxColumn(t));let o=[];const s=[],r=[],l=i.lineNumber-1,a=n.lineNumber-1;let u=null;for(let e=l;e<=a;e++){const t=this.modelLineProjections[e];if(t.isVisible()){const n=t.getViewLineNumberOfModelPosition(0,e===l?i.column:1),o=t.getViewLineNumberOfModelPosition(0,this.model.getLineMaxColumn(e+1)),a=o-n+1;let h=0;a>1&&1===t.getViewLineMinColumn(this.model,e+1,o)&&(h=0===n?1:2),s.push(a),r.push(h),null===u&&(u=new c.y(e+1,0))}else null!==u&&(o=o.concat(this.model.guides.getLinesIndentGuides(u.lineNumber,e)),u=null)}null!==u&&(o=o.concat(this.model.guides.getLinesIndentGuides(u.lineNumber,n.lineNumber)),u=null);const h=t-e+1,d=new Array(h);let g=0;for(let e=0,t=o.length;e<t;e++){let t=o[e];const i=Math.min(h-g,s[e]),n=r[e];let l;l=2===n?0:1===n?1:i;for(let e=0;e<i;e++)e===l&&(t=0),d[g++]=t}return d}getViewLineContent(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineContent(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineLength(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineLength(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMinColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMinColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMaxColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMaxColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineData(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineData(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLinesData(e,t,i){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const n=this.projectedModelLineLineCounts.getIndexOf(e-1);let o=e;const s=n.index,r=n.remainder,l=[];for(let n=s,a=this.model.getLineCount();n<a;n++){const a=this.modelLineProjections[n];if(!a.isVisible())continue;const u=n===s?r:0;let h=a.getViewLineCount()-u,d=!1;if(o+h>t&&(d=!0,h=t-o+1),a.getViewLinesData(this.model,n+1,u,h,o-e,i,l),o+=h,d)break}return l}validateViewPosition(e,t,i){e=this._toValidViewLineNumber(e);const n=this.projectedModelLineLineCounts.getIndexOf(e-1),o=n.index,s=n.remainder,r=this.modelLineProjections[o],l=r.getViewLineMinColumn(this.model,o+1,s),a=r.getViewLineMaxColumn(this.model,o+1,s);t<l&&(t=l),t>a&&(t=a);const u=r.getModelColumnOfViewPosition(s,t);return this.model.validatePosition(new c.y(o+1,u)).equals(i)?new c.y(e,t):this.convertModelPositionToViewPosition(i.lineNumber,i.column)}validateViewRange(e,t){const i=this.validateViewPosition(e.startLineNumber,e.startColumn,t.getStartPosition()),n=this.validateViewPosition(e.endLineNumber,e.endColumn,t.getEndPosition());return new g.Q(i.lineNumber,i.column,n.lineNumber,n.column)}convertViewPositionToModelPosition(e,t){const i=this.getViewLineInfo(e),n=this.modelLineProjections[i.modelLineNumber-1].getModelColumnOfViewPosition(i.modelLineWrappedLineIdx,t);return this.model.validatePosition(new c.y(i.modelLineNumber,n))}convertViewRangeToModelRange(e){const t=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),i=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);return new g.Q(t.lineNumber,t.column,i.lineNumber,i.column)}convertModelPositionToViewPosition(e,t,i=2){const n=this.model.validatePosition(new c.y(e,t)),o=n.lineNumber,s=n.column;let r=o-1,l=!1;for(;r>0&&!this.modelLineProjections[r].isVisible();)r--,l=!0;if(0===r&&!this.modelLineProjections[r].isVisible())return new c.y(1,1);const a=1+this.projectedModelLineLineCounts.getPrefixSum(r);let u;return u=l?this.modelLineProjections[r].getViewPositionOfModelPosition(a,this.model.getLineMaxColumn(r+1),i):this.modelLineProjections[o-1].getViewPositionOfModelPosition(a,s,i),u}convertModelRangeToViewRange(e,t=0){if(e.isEmpty()){const i=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,t);return g.Q.fromPositions(i)}{const t=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,1),i=this.convertModelPositionToViewPosition(e.endLineNumber,e.endColumn,0);return new g.Q(t.lineNumber,t.column,i.lineNumber,i.column)}}getViewLineNumberOfModelPosition(e,t){let i=e-1;if(this.modelLineProjections[i].isVisible()){const e=1+this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections[i].getViewLineNumberOfModelPosition(e,t)}for(;i>0&&!this.modelLineProjections[i].isVisible();)i--;if(0===i&&!this.modelLineProjections[i].isVisible())return 1;const n=1+this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections[i].getViewLineNumberOfModelPosition(n,this.model.getLineMaxColumn(i+1))}getDecorationsInRange(e,t,i){const n=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),o=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);if(o.lineNumber-n.lineNumber<=e.endLineNumber-e.startLineNumber)return this.model.getDecorationsInRange(new g.Q(n.lineNumber,1,o.lineNumber,o.column),t,i);let s=[];const r=n.lineNumber-1,l=o.lineNumber-1;let a=null;for(let e=r;e<=l;e++){if(this.modelLineProjections[e].isVisible())null===a&&(a=new c.y(e+1,e===r?n.column:1));else if(null!==a){const n=this.model.getLineMaxColumn(e);s=s.concat(this.model.getDecorationsInRange(new g.Q(a.lineNumber,a.column,e,n),t,i)),a=null}}null!==a&&(s=s.concat(this.model.getDecorationsInRange(new g.Q(a.lineNumber,a.column,o.lineNumber,o.column),t,i)),a=null),s.sort(((e,t)=>{const i=g.Q.compareRangesUsingStarts(e.range,t.range);return 0===i?e.id<t.id?-1:e.id>t.id?1:0:i}));const u=[];let h=0,d=null;for(const e of s){const t=e.id;d!==t&&(d=t,u[h++]=e)}return u}getInjectedTextAt(e){const t=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[t.modelLineNumber-1].getInjectedTextAt(t.modelLineWrappedLineIdx,e.column)}normalizePosition(e,t){const i=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[i.modelLineNumber-1].normalizePosition(i.modelLineWrappedLineIdx,e,t)}getLineIndentColumn(e){const t=this.getViewLineInfo(e);return 0===t.modelLineWrappedLineIdx?this.model.getLineIndentColumn(t.modelLineNumber):0}}class j{constructor(e,t){this.modelLineNumber=e,this.modelLineWrappedLineIdx=t}}class k{constructor(e,t){this.modelRange=e,this.viewLines=t}}class A{constructor(e){this._lines=e}convertViewPositionToModelPosition(e){return this._lines.convertViewPositionToModelPosition(e.lineNumber,e.column)}convertViewRangeToModelRange(e){return this._lines.convertViewRangeToModelRange(e)}validateViewPosition(e,t){return this._lines.validateViewPosition(e.lineNumber,e.column,t)}validateViewRange(e,t){return this._lines.validateViewRange(e,t)}convertModelPositionToViewPosition(e,t){return this._lines.convertModelPositionToViewPosition(e.lineNumber,e.column,t)}convertModelRangeToViewRange(e,t){return this._lines.convertModelRangeToViewRange(e,t)}modelPositionIsVisible(e){return this._lines.modelPositionIsVisible(e.lineNumber,e.column)}getModelLineViewLineCount(e){return this._lines.getModelLineViewLineCount(e)}getViewLineNumberOfModelPosition(e,t){return this._lines.getViewLineNumberOfModelPosition(e,t)}}class z{constructor(e){this.model=e}dispose(){}createCoordinatesConverter(){return new H(this)}getHiddenAreas(){return[]}setHiddenAreas(e){return!1}setTabSize(e){return!1}setWrappingSettings(e,t,i,n){return!1}createLineBreaksComputer(){const e=[];return{addRequest:(t,i,n)=>{e.push(null)},finalize:()=>e}}onModelFlushed(){}onModelLinesDeleted(e,t,i){return new p.Uf(t,i)}onModelLinesInserted(e,t,i,n){return new p.rZ(t,i)}onModelLineChanged(e,t,i){return[!1,new p.bu(t,1),null,null]}acceptVersionId(e){}getViewLineCount(){return this.model.getLineCount()}getActiveIndentGuide(e,t,i){return{startLineNumber:e,endLineNumber:e,indent:0}}getViewLinesBracketGuides(e,t,i){return new Array(t-e+1).fill([])}getViewLinesIndentGuides(e,t){const i=t-e+1,n=new Array(i);for(let e=0;e<i;e++)n[e]=0;return n}getViewLineContent(e){return this.model.getLineContent(e)}getViewLineLength(e){return this.model.getLineLength(e)}getViewLineMinColumn(e){return this.model.getLineMinColumn(e)}getViewLineMaxColumn(e){return this.model.getLineMaxColumn(e)}getViewLineData(e){const t=this.model.tokenization.getLineTokens(e),i=t.getLineContent();return new V.GP(i,!1,1,i.length+1,0,t.inflate(),null)}getViewLinesData(e,t,i){const n=this.model.getLineCount();e=Math.min(Math.max(1,e),n),t=Math.min(Math.max(1,t),n);const o=[];for(let n=e;n<=t;n++){const t=n-e;o[t]=i[t]?this.getViewLineData(n):null}return o}getDecorationsInRange(e,t,i){return this.model.getDecorationsInRange(e,t,i)}normalizePosition(e,t){return this.model.normalizePosition(e,t)}getLineIndentColumn(e){return this.model.getLineIndentColumn(e)}getInjectedTextAt(e){return null}}class H{constructor(e){this._lines=e}_validPosition(e){return this._lines.model.validatePosition(e)}_validRange(e){return this._lines.model.validateRange(e)}convertViewPositionToModelPosition(e){return this._validPosition(e)}convertViewRangeToModelRange(e){return this._validRange(e)}validateViewPosition(e,t){return this._validPosition(t)}validateViewRange(e,t){return this._validRange(t)}convertModelPositionToViewPosition(e){return this._validPosition(e)}convertModelRangeToViewRange(e){return this._validRange(e)}modelPositionIsVisible(e){const t=this._lines.model.getLineCount();return!(e.lineNumber<1||e.lineNumber>t)}getModelLineViewLineCount(e){return 1}getViewLineNumberOfModelPosition(e,t){return e}}class W extends r.jG{constructor(e,t,i,n,s,r,l,a){if(super(),this.languageConfigurationService=l,this._themeService=a,this._editorId=e,this._configuration=t,this.model=i,this._eventDispatcher=new v.ql,this.onEvent=this._eventDispatcher.onEvent,this.cursorConfig=new d.d$(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._tokenizeViewportSoon=this._register(new o.uC((()=>this.tokenizeViewport()),50)),this._updateConfigurationViewLineCount=this._register(new o.uC((()=>this._updateConfigurationViewLineCountNow()),0)),this._hasFocus=!1,this._viewportStart=B.create(this.model),this.model.isTooLargeForTokenization())this._lines=new z(this.model);else{const e=this._configuration.options,t=e.get(46),i=e.get(127),o=e.get(134),r=e.get(126);this._lines=new O(this._editorId,this.model,n,s,t,this.model.getOptions().tabSize,i,o.wrappingColumn,r)}this.coordinatesConverter=this._lines.createCoordinatesConverter(),this._cursor=this._register(new h._(i,this,this.coordinatesConverter,this.cursorConfig)),this.viewLayout=this._register(new C.G(this._configuration,this.getLineCount(),r)),this._register(this.viewLayout.onDidScroll((e=>{e.scrollTopChanged&&this._tokenizeViewportSoon.schedule(),e.scrollTopChanged&&this._viewportStart.invalidate(),this._eventDispatcher.emitSingleViewEvent(new p.lg(e)),this._eventDispatcher.emitOutgoingEvent(new v.s1(e.oldScrollWidth,e.oldScrollLeft,e.oldScrollHeight,e.oldScrollTop,e.scrollWidth,e.scrollLeft,e.scrollHeight,e.scrollTop))}))),this._register(this.viewLayout.onDidContentSizeChange((e=>{this._eventDispatcher.emitOutgoingEvent(e)}))),this._decorations=new b.UB(this._editorId,this.model,this._configuration,this._lines,this.coordinatesConverter),this._registerModelEvents(),this._register(this._configuration.onDidChangeFast((e=>{try{const t=this._eventDispatcher.beginEmitViewEvents();this._onConfigurationChanged(t,e)}finally{this._eventDispatcher.endEmitViewEvents()}}))),this._register(_.v.getInstance().onDidChange((()=>{this._eventDispatcher.emitSingleViewEvent(new p.U)}))),this._register(this._themeService.onDidColorThemeChange((e=>{this._invalidateDecorationsColorCache(),this._eventDispatcher.emitSingleViewEvent(new p.tO(e))}))),this._updateConfigurationViewLineCountNow()}dispose(){super.dispose(),this._decorations.dispose(),this._lines.dispose(),this._viewportStart.dispose(),this._eventDispatcher.dispose()}createLineBreaksComputer(){return this._lines.createLineBreaksComputer()}addViewEventHandler(e){this._eventDispatcher.addViewEventHandler(e)}removeViewEventHandler(e){this._eventDispatcher.removeViewEventHandler(e)}_updateConfigurationViewLineCountNow(){this._configuration.setViewLineCount(this._lines.getViewLineCount())}tokenizeViewport(){const e=this.viewLayout.getLinesViewportData(),t=new g.Q(e.startLineNumber,this.getLineMinColumn(e.startLineNumber),e.endLineNumber,this.getLineMaxColumn(e.endLineNumber)),i=this._toModelVisibleRanges(t);for(const e of i)this.model.tokenization.tokenizeViewport(e.startLineNumber,e.endLineNumber)}setHasFocus(e){this._hasFocus=e,this._cursor.setHasFocus(e),this._eventDispatcher.emitSingleViewEvent(new p.E5(e)),this._eventDispatcher.emitOutgoingEvent(new v.TA(!e,e))}onCompositionStart(){this._eventDispatcher.emitSingleViewEvent(new p.Kb)}onCompositionEnd(){this._eventDispatcher.emitSingleViewEvent(new p.dQ)}_onConfigurationChanged(e,t){let i=null;if(this._viewportStart.isValid){const e=new c.y(this._viewportStart.viewLineNumber,this.getLineMinColumn(this._viewportStart.viewLineNumber));i=this.coordinatesConverter.convertViewPositionToModelPosition(e)}let n=!1;const o=this._configuration.options,s=o.get(46),r=o.get(127),l=o.get(134),a=o.get(126);if(this._lines.setWrappingSettings(s,r,l.wrappingColumn,a)&&(e.emitViewEvent(new p.zv),e.emitViewEvent(new p.M7),e.emitViewEvent(new p.h9(null)),this._cursor.onLineMappingChanged(e),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),0!==this.viewLayout.getCurrentScrollTop()&&(n=!0),this._updateConfigurationViewLineCount.schedule()),t.hasChanged(83)&&(this._decorations.reset(),e.emitViewEvent(new p.h9(null))),e.emitViewEvent(new p.Ey(t)),this.viewLayout.onConfigurationChanged(t),n&&i){const e=this.coordinatesConverter.convertModelPositionToViewPosition(i),t=this.viewLayout.getVerticalOffsetForLineNumber(e.lineNumber);this.viewLayout.setScrollPosition({scrollTop:t+this._viewportStart.startLineDelta},1)}d.d$.shouldRecreate(t)&&(this.cursorConfig=new d.d$(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig))}_registerModelEvents(){this._register(this.model.onDidChangeContentOrInjectedText((e=>{try{const t=this._eventDispatcher.beginEmitViewEvents();let i=!1,o=!1;const s=e instanceof m.Ic?e.rawContentChangedEvent.changes:e.changes,r=e instanceof m.Ic?e.rawContentChangedEvent.versionId:null,l=this._lines.createLineBreaksComputer();for(const e of s)switch(e.changeType){case 4:for(let t=0;t<e.detail.length;t++){const i=e.detail[t];let n=e.injectedTexts[t];n&&(n=n.filter((e=>!e.ownerId||e.ownerId===this._editorId))),l.addRequest(i,n,null)}break;case 2:{let t=null;e.injectedText&&(t=e.injectedText.filter((e=>!e.ownerId||e.ownerId===this._editorId))),l.addRequest(e.detail,t,null);break}}const a=l.finalize(),u=new n.j3(a);for(const e of s)switch(e.changeType){case 1:this._lines.onModelFlushed(),t.emitViewEvent(new p.zv),this._decorations.reset(),this.viewLayout.onFlushed(this.getLineCount()),i=!0;break;case 3:{const n=this._lines.onModelLinesDeleted(r,e.fromLineNumber,e.toLineNumber);null!==n&&(t.emitViewEvent(n),this.viewLayout.onLinesDeleted(n.fromLineNumber,n.toLineNumber)),i=!0;break}case 4:{const n=u.takeCount(e.detail.length),o=this._lines.onModelLinesInserted(r,e.fromLineNumber,e.toLineNumber,n);null!==o&&(t.emitViewEvent(o),this.viewLayout.onLinesInserted(o.fromLineNumber,o.toLineNumber)),i=!0;break}case 2:{const i=u.dequeue(),[n,s,l,a]=this._lines.onModelLineChanged(r,e.lineNumber,i);o=n,s&&t.emitViewEvent(s),l&&(t.emitViewEvent(l),this.viewLayout.onLinesInserted(l.fromLineNumber,l.toLineNumber)),a&&(t.emitViewEvent(a),this.viewLayout.onLinesDeleted(a.fromLineNumber,a.toLineNumber));break}}null!==r&&this._lines.acceptVersionId(r),this.viewLayout.onHeightMaybeChanged(),!i&&o&&(t.emitViewEvent(new p.M7),t.emitViewEvent(new p.h9(null)),this._cursor.onLineMappingChanged(t),this._decorations.onLineMappingChanged())}finally{this._eventDispatcher.endEmitViewEvents()}const t=this._viewportStart.isValid;if(this._viewportStart.invalidate(),this._configuration.setModelLineCount(this.model.getLineCount()),this._updateConfigurationViewLineCountNow(),!this._hasFocus&&this.model.getAttachedEditorCount()>=2&&t){const e=this.model._getTrackedRange(this._viewportStart.modelTrackedRange);if(e){const t=this.coordinatesConverter.convertModelPositionToViewPosition(e.getStartPosition()),i=this.viewLayout.getVerticalOffsetForLineNumber(t.lineNumber);this.viewLayout.setScrollPosition({scrollTop:i+this._viewportStart.startLineDelta},1)}}try{const t=this._eventDispatcher.beginEmitViewEvents();e instanceof m.Ic&&t.emitOutgoingEvent(new v.VN(e.contentChangedEvent)),this._cursor.onModelContentChanged(t,e)}finally{this._eventDispatcher.endEmitViewEvents()}this._tokenizeViewportSoon.schedule()}))),this._register(this.model.onDidChangeTokens((e=>{const t=[];for(let i=0,n=e.ranges.length;i<n;i++){const n=e.ranges[i],o=this.coordinatesConverter.convertModelPositionToViewPosition(new c.y(n.fromLineNumber,1)).lineNumber,s=this.coordinatesConverter.convertModelPositionToViewPosition(new c.y(n.toLineNumber,this.model.getLineMaxColumn(n.toLineNumber))).lineNumber;t[i]={fromLineNumber:o,toLineNumber:s}}this._eventDispatcher.emitSingleViewEvent(new p.GL(t)),e.tokenizationSupportChanged&&this._tokenizeViewportSoon.schedule(),this._eventDispatcher.emitOutgoingEvent(new v.Md(e))}))),this._register(this.model.onDidChangeLanguageConfiguration((e=>{this._eventDispatcher.emitSingleViewEvent(new p.qK),this.cursorConfig=new d.d$(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new v.Qo(e))}))),this._register(this.model.onDidChangeLanguage((e=>{this.cursorConfig=new d.d$(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new v.qI(e))}))),this._register(this.model.onDidChangeOptions((e=>{if(this._lines.setTabSize(this.model.getOptions().tabSize)){try{const e=this._eventDispatcher.beginEmitViewEvents();e.emitViewEvent(new p.zv),e.emitViewEvent(new p.M7),e.emitViewEvent(new p.h9(null)),this._cursor.onLineMappingChanged(e),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule()}this.cursorConfig=new d.d$(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new v.eM(e))}))),this._register(this.model.onDidChangeDecorations((e=>{this._decorations.onModelDecorationsChanged(),this._eventDispatcher.emitSingleViewEvent(new p.h9(e)),this._eventDispatcher.emitOutgoingEvent(new v.FU(e))})))}setHiddenAreas(e){let t=!1;try{const i=this._eventDispatcher.beginEmitViewEvents();t=this._lines.setHiddenAreas(e),t&&(i.emitViewEvent(new p.zv),i.emitViewEvent(new p.M7),i.emitViewEvent(new p.h9(null)),this._cursor.onLineMappingChanged(i),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this.viewLayout.onHeightMaybeChanged())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule(),t&&this._eventDispatcher.emitOutgoingEvent(new v.x0)}getVisibleRangesPlusViewportAboveBelow(){const e=this._configuration.options.get(133),t=this._configuration.options.get(61),i=Math.max(20,Math.round(e.height/t)),n=this.viewLayout.getLinesViewportData(),o=Math.max(1,n.completelyVisibleStartLineNumber-i),s=Math.min(this.getLineCount(),n.completelyVisibleEndLineNumber+i);return this._toModelVisibleRanges(new g.Q(o,this.getLineMinColumn(o),s,this.getLineMaxColumn(s)))}getVisibleRanges(){const e=this.getCompletelyVisibleViewRange();return this._toModelVisibleRanges(e)}getHiddenAreas(){return this._lines.getHiddenAreas()}_toModelVisibleRanges(e){const t=this.coordinatesConverter.convertViewRangeToModelRange(e),i=this._lines.getHiddenAreas();if(0===i.length)return[t];const n=[];let o=0,s=t.startLineNumber,r=t.startColumn;const l=t.endLineNumber,a=t.endColumn;for(let e=0,t=i.length;e<t;e++){const t=i[e].startLineNumber,a=i[e].endLineNumber;a<s||(t>l||(s<t&&(n[o++]=new g.Q(s,r,t-1,this.model.getLineMaxColumn(t-1))),s=a+1,r=1))}return(s<l||s===l&&r<a)&&(n[o++]=new g.Q(s,r,l,a)),n}getCompletelyVisibleViewRange(){const e=this.viewLayout.getLinesViewportData(),t=e.completelyVisibleStartLineNumber,i=e.completelyVisibleEndLineNumber;return new g.Q(t,this.getLineMinColumn(t),i,this.getLineMaxColumn(i))}getCompletelyVisibleViewRangeAtScrollTop(e){const t=this.viewLayout.getLinesViewportDataAtScrollTop(e),i=t.completelyVisibleStartLineNumber,n=t.completelyVisibleEndLineNumber;return new g.Q(i,this.getLineMinColumn(i),n,this.getLineMaxColumn(n))}saveState(){const e=this.viewLayout.saveState(),t=e.scrollTop,i=this.viewLayout.getLineNumberAtVerticalOffset(t),n=this.coordinatesConverter.convertViewPositionToModelPosition(new c.y(i,this.getLineMinColumn(i))),o=this.viewLayout.getVerticalOffsetForLineNumber(i)-t;return{scrollLeft:e.scrollLeft,firstPosition:n,firstPositionDeltaTop:o}}reduceRestoreState(e){if(void 0===e.firstPosition)return this._reduceRestoreStateCompatibility(e);const t=this.model.validatePosition(e.firstPosition),i=this.coordinatesConverter.convertModelPositionToViewPosition(t),n=this.viewLayout.getVerticalOffsetForLineNumber(i.lineNumber)-e.firstPositionDeltaTop;return{scrollLeft:e.scrollLeft,scrollTop:n}}_reduceRestoreStateCompatibility(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTopWithoutViewZones}}getTabSize(){return this.model.getOptions().tabSize}getLineCount(){return this._lines.getViewLineCount()}setViewport(e,t,i){this._viewportStart.update(this,e)}getActiveIndentGuide(e,t,i){return this._lines.getActiveIndentGuide(e,t,i)}getLinesIndentGuides(e,t){return this._lines.getViewLinesIndentGuides(e,t)}getBracketGuidesInRangeByLine(e,t,i,n){return this._lines.getViewLinesBracketGuides(e,t,i,n)}getLineContent(e){return this._lines.getViewLineContent(e)}getLineLength(e){return this._lines.getViewLineLength(e)}getLineMinColumn(e){return this._lines.getViewLineMinColumn(e)}getLineMaxColumn(e){return this._lines.getViewLineMaxColumn(e)}getLineFirstNonWhitespaceColumn(e){const t=a.HG(this.getLineContent(e));return-1===t?0:t+1}getLineLastNonWhitespaceColumn(e){const t=a.lT(this.getLineContent(e));return-1===t?0:t+2}getDecorationsInViewport(e){return this._decorations.getDecorationsViewportData(e).decorations}getInjectedTextAt(e){return this._lines.getInjectedTextAt(e)}getViewportViewLineRenderingData(e,t){const i=this._decorations.getDecorationsViewportData(e).inlineDecorations[t-e.startLineNumber];return this._getViewLineRenderingData(t,i)}getViewLineRenderingData(e){const t=this._decorations.getInlineDecorationsOnLine(e);return this._getViewLineRenderingData(e,t)}_getViewLineRenderingData(e,t){const i=this.model.mightContainRTL(),n=this.model.mightContainNonBasicASCII(),o=this.getTabSize(),s=this._lines.getViewLineData(e);return s.inlineDecorations&&(t=[...t,...s.inlineDecorations.map((t=>t.toInlineDecoration(e)))]),new V.qL(s.minColumn,s.maxColumn,s.content,s.continuesWithWrappedLine,i,n,s.tokens,t,o,s.startVisibleColumn)}getViewLineData(e){return this._lines.getViewLineData(e)}getMinimapLinesRenderingData(e,t,i){const n=this._lines.getViewLinesData(e,t,i);return new V.nt(this.getTabSize(),n)}getAllOverviewRulerDecorations(e){const t=this.model.getOverviewRulerDecorations(this._editorId,(0,u.$C)(this._configuration.options)),i=new F;for(const n of t){const t=n.options,o=t.overviewRuler;if(!o)continue;const s=o.position;if(0===s)continue;const r=o.getColor(e.value),l=this.coordinatesConverter.getViewLineNumberOfModelPosition(n.range.startLineNumber,n.range.startColumn),a=this.coordinatesConverter.getViewLineNumberOfModelPosition(n.range.endLineNumber,n.range.endColumn);i.accept(r,t.zIndex,l,a,s)}return i.asArray}_invalidateDecorationsColorCache(){const e=this.model.getOverviewRulerDecorations();for(const t of e){const e=t.options.overviewRuler;e&&e.invalidateCachedColor();const i=t.options.minimap;i&&i.invalidateCachedColor()}}getValueInRange(e,t){const i=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueInRange(i,t)}deduceModelPositionRelativeToViewPosition(e,t,i){const n=this.coordinatesConverter.convertViewPositionToModelPosition(e);2===this.model.getEOL().length&&(t<0?t-=i:t+=i);const o=this.model.getOffsetAt(n)+t;return this.model.getPositionAt(o)}getPlainTextToCopy(e,t,i){const n=i?"\r\n":this.model.getEOL();(e=e.slice(0)).sort(g.Q.compareRangesUsingStarts);let o=!1,s=!1;for(const t of e)t.isEmpty()?o=!0:s=!0;if(!s){if(!t)return"";const i=e.map((e=>e.startLineNumber));let o="";for(let e=0;e<i.length;e++)e>0&&i[e-1]===i[e]||(o+=this.model.getLineContent(i[e])+n);return o}if(o&&t){const t=[];let n=0;for(const o of e){const e=o.startLineNumber;o.isEmpty()?e!==n&&t.push(this.model.getLineContent(e)):t.push(this.model.getValueInRange(o,i?2:0)),n=e}return 1===t.length?t[0]:t}const r=[];for(const t of e)t.isEmpty()||r.push(this.model.getValueInRange(t,i?2:0));return 1===r.length?r[0]:r}getRichTextToCopy(e,t){const i=this.model.getLanguageId();if(i===w.vH)return null;if(1!==e.length)return null;let n=e[0];if(n.isEmpty()){if(!t)return null;const e=n.startLineNumber;n=new g.Q(e,this.model.getLineMinColumn(e),e,this.model.getLineMaxColumn(e))}const o=this._configuration.options.get(46),s=this._getColorMap();let r;if(/[:;\\\/<>]/.test(o.fontFamily)||o.fontFamily===u.jU.fontFamily)r=u.jU.fontFamily;else{r=o.fontFamily,r=r.replace(/"/g,"'");if(!/[,']/.test(r)){/[+ ]/.test(r)&&(r=`'${r}'`)}r=`${r}, ${u.jU.fontFamily}`}return{mode:i,html:`<div style="color: ${s[1]};background-color: ${s[2]};font-family: ${r};font-weight: ${o.fontWeight};font-size: ${o.fontSize}px;line-height: ${o.lineHeight}px;white-space: pre;">`+this._getHTMLToCopy(n,s)+"</div>"}}_getHTMLToCopy(e,t){const i=e.startLineNumber,n=e.startColumn,o=e.endLineNumber,s=e.endColumn,r=this.getTabSize();let a="";for(let e=i;e<=o;e++){const u=this.model.tokenization.getLineTokens(e),h=u.getLineContent(),d=e===i?n-1:0,c=e===o?s-1:h.length;a+=""===h?"<br>":(0,f.s0)(h,u.inflate(),t,d,c,r,l.uF)}return a}_getColorMap(){const e=L.dG.getColorMap(),t=["#000000"];if(e)for(let i=1,n=e.length;i<n;i++)t[i]=s.Q1.Format.CSS.formatHex(e[i]);return t}getPrimaryCursorState(){return this._cursor.getPrimaryCursorState()}getLastAddedCursorIndex(){return this._cursor.getLastAddedCursorIndex()}getCursorStates(){return this._cursor.getCursorStates()}setCursorStates(e,t,i){return this._withViewEventsCollector((n=>this._cursor.setStates(n,e,t,i)))}getCursorColumnSelectData(){return this._cursor.getCursorColumnSelectData()}getCursorAutoClosedCharacters(){return this._cursor.getAutoClosedCharacters()}setCursorColumnSelectData(e){this._cursor.setCursorColumnSelectData(e)}getPrevEditOperationType(){return this._cursor.getPrevEditOperationType()}setPrevEditOperationType(e){this._cursor.setPrevEditOperationType(e)}getSelection(){return this._cursor.getSelection()}getSelections(){return this._cursor.getSelections()}getPosition(){return this._cursor.getPrimaryCursorState().modelState.position}setSelections(e,t,i=0){this._withViewEventsCollector((n=>this._cursor.setSelections(n,e,t,i)))}saveCursorState(){return this._cursor.saveState()}restoreCursorState(e){this._withViewEventsCollector((t=>this._cursor.restoreState(t,e)))}_executeCursorEdit(e){this._cursor.context.cursorConfig.readOnly?this._eventDispatcher.emitOutgoingEvent(new v.cT):this._withViewEventsCollector(e)}executeEdits(e,t,i){this._executeCursorEdit((n=>this._cursor.executeEdits(n,e,t,i)))}startComposition(){this._executeCursorEdit((e=>this._cursor.startComposition(e)))}endComposition(e){this._executeCursorEdit((t=>this._cursor.endComposition(t,e)))}type(e,t){this._executeCursorEdit((i=>this._cursor.type(i,e,t)))}compositionType(e,t,i,n,o){this._executeCursorEdit((s=>this._cursor.compositionType(s,e,t,i,n,o)))}paste(e,t,i,n){this._executeCursorEdit((o=>this._cursor.paste(o,e,t,i,n)))}cut(e){this._executeCursorEdit((t=>this._cursor.cut(t,e)))}executeCommand(e,t){this._executeCursorEdit((i=>this._cursor.executeCommand(i,e,t)))}executeCommands(e,t){this._executeCursorEdit((i=>this._cursor.executeCommands(i,e,t)))}revealPrimaryCursor(e,t,i=!1){this._withViewEventsCollector((n=>this._cursor.revealPrimary(n,e,i,0,t,0)))}revealTopMostCursor(e){const t=this._cursor.getTopMostViewPosition(),i=new g.Q(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector((t=>t.emitViewEvent(new p.Hf(e,!1,i,null,0,!0,0))))}revealBottomMostCursor(e){const t=this._cursor.getBottomMostViewPosition(),i=new g.Q(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector((t=>t.emitViewEvent(new p.Hf(e,!1,i,null,0,!0,0))))}revealRange(e,t,i,n,o){this._withViewEventsCollector((s=>s.emitViewEvent(new p.Hf(e,!1,i,null,n,t,o))))}changeWhitespace(e){this.viewLayout.changeWhitespace(e)&&(this._eventDispatcher.emitSingleViewEvent(new p.fu),this._eventDispatcher.emitOutgoingEvent(new v.fu))}_withViewEventsCollector(e){try{return e(this._eventDispatcher.beginEmitViewEvents())}finally{this._eventDispatcher.endEmitViewEvents()}}normalizePosition(e,t){return this._lines.normalizePosition(e,t)}getLineIndentColumn(e){return this._lines.getLineIndentColumn(e)}}class B{constructor(e,t,i,n,o){this._model=e,this._viewLineNumber=t,this._isValid=i,this._modelTrackedRange=n,this._startLineDelta=o}static create(e){const t=e._setTrackedRange(null,new g.Q(1,1,1,1),1);return new B(e,1,!1,t,0)}get viewLineNumber(){return this._viewLineNumber}get isValid(){return this._isValid}get modelTrackedRange(){return this._modelTrackedRange}get startLineDelta(){return this._startLineDelta}dispose(){this._model._setTrackedRange(this._modelTrackedRange,null,1)}update(e,t){const i=e.coordinatesConverter.convertViewPositionToModelPosition(new c.y(t,e.getLineMinColumn(t))),n=e.model._setTrackedRange(this._modelTrackedRange,new g.Q(i.lineNumber,i.column,i.lineNumber,i.column),1),o=e.viewLayout.getVerticalOffsetForLineNumber(t),s=e.viewLayout.getCurrentScrollTop();this._viewLineNumber=t,this._isValid=!0,this._modelTrackedRange=n,this._startLineDelta=s-o}invalidate(){this._isValid=!1}}class F{constructor(){this._asMap=Object.create(null),this.asArray=[]}accept(e,t,i,n,o){const s=this._asMap[e];if(s){const e=s.data,t=e[e.length-3],r=e[e.length-1];if(t===o&&r+1>=i)return void(n>r&&(e[e.length-1]=n));e.push(o,i,n)}else{const s=new V.Uv(e,t,[o,i,n]);this._asMap[e]=s,this.asArray.push(s)}}}}}]);
